<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Migs Germar">
<meta name="dcterms.date" content="2021-06-13">
<meta name="description" content="I combine multiple datasets about NYC high schools to explore the effect of students’ demographics on SAT performance. The project ends with a multiple linear regression model showing that the effect of race percentages on a school’s average SAT score is significant.">

<title>Migs Germar’s Data Science Blog - How Student Demographic Affects SAT Performance in NYC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../posts/images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-99SLFW8P3J"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-99SLFW8P3J', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Migs Germar’s Data Science Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/MiguelAHG" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/migs-germar/" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.facebook.com/miguelantonio.germar" rel="" target=""><i class="bi bi-facebook" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">How Student Demographic Affects SAT Performance in NYC</h1>
                  <div>
        <div class="description">
          I combine multiple datasets about NYC high schools to explore the effect of students’ demographics on SAT performance. The project ends with a multiple linear regression model showing that the effect of race percentages on a school’s average SAT score is significant.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">pandas</div>
                <div class="quarto-category">matplotlib</div>
                <div class="quarto-category">seaborn</div>
                <div class="quarto-category">statsmodels</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Migs Germar </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 13, 2021</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#package-installs" id="toc-package-installs" class="nav-link" data-scroll-target="#package-installs">Package Installs</a></li>
  <li><a href="#data-transformation-and-cleaning" id="toc-data-transformation-and-cleaning" class="nav-link" data-scroll-target="#data-transformation-and-cleaning">Data Transformation and Cleaning</a>
  <ul class="collapse">
  <li><a href="#list-of-datasets" id="toc-list-of-datasets" class="nav-link" data-scroll-target="#list-of-datasets">List of Datasets</a></li>
  <li><a href="#sat-total-scores" id="toc-sat-total-scores" class="nav-link" data-scroll-target="#sat-total-scores">SAT Total Scores</a></li>
  <li><a href="#school-location" id="toc-school-location" class="nav-link" data-scroll-target="#school-location">School Location</a></li>
  <li><a href="#survey-dataset-columns" id="toc-survey-dataset-columns" class="nav-link" data-scroll-target="#survey-dataset-columns">Survey Dataset Columns</a></li>
  <li><a href="#dbn-column" id="toc-dbn-column" class="nav-link" data-scroll-target="#dbn-column">DBN Column</a></li>
  <li><a href="#condensing-datasets" id="toc-condensing-datasets" class="nav-link" data-scroll-target="#condensing-datasets">Condensing Datasets</a>
  <ul class="collapse">
  <li><a href="#advanced-placement-dataset" id="toc-advanced-placement-dataset" class="nav-link" data-scroll-target="#advanced-placement-dataset">Advanced Placement Dataset</a></li>
  <li><a href="#class-size-dataset" id="toc-class-size-dataset" class="nav-link" data-scroll-target="#class-size-dataset">Class Size Dataset</a></li>
  <li><a href="#demographics-dataset" id="toc-demographics-dataset" class="nav-link" data-scroll-target="#demographics-dataset">Demographics Dataset</a></li>
  <li><a href="#graduation-dataset" id="toc-graduation-dataset" class="nav-link" data-scroll-target="#graduation-dataset">Graduation Dataset</a></li>
  </ul></li>
  <li><a href="#column-names" id="toc-column-names" class="nav-link" data-scroll-target="#column-names">Column Names</a></li>
  <li><a href="#combining-datasets" id="toc-combining-datasets" class="nav-link" data-scroll-target="#combining-datasets">Combining Datasets</a>
  <ul class="collapse">
  <li><a href="#heatmap-of-dbns" id="toc-heatmap-of-dbns" class="nav-link" data-scroll-target="#heatmap-of-dbns">Heatmap of DBNs</a></li>
  <li><a href="#left-join" id="toc-left-join" class="nav-link" data-scroll-target="#left-join">Left join</a></li>
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join">Inner join</a></li>
  </ul></li>
  <li><a href="#city-school-districts" id="toc-city-school-districts" class="nav-link" data-scroll-target="#city-school-districts">City School Districts</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#correlation-coefficients" id="toc-correlation-coefficients" class="nav-link" data-scroll-target="#correlation-coefficients">Correlation Coefficients</a></li>
  <li><a href="#ap-exam-results" id="toc-ap-exam-results" class="nav-link" data-scroll-target="#ap-exam-results">AP Exam Results</a></li>
  <li><a href="#survey-data" id="toc-survey-data" class="nav-link" data-scroll-target="#survey-data">Survey Data</a></li>
  <li><a href="#demographics" id="toc-demographics" class="nav-link" data-scroll-target="#demographics">Demographics</a>
  <ul class="collapse">
  <li><a href="#school-size" id="toc-school-size" class="nav-link" data-scroll-target="#school-size">School Size</a></li>
  <li><a href="#english-proficiency" id="toc-english-proficiency" class="nav-link" data-scroll-target="#english-proficiency">English Proficiency</a></li>
  <li><a href="#sped-percentage" id="toc-sped-percentage" class="nav-link" data-scroll-target="#sped-percentage">SpEd Percentage</a></li>
  <li><a href="#sex" id="toc-sex" class="nav-link" data-scroll-target="#sex">Sex</a></li>
  <li><a href="#race" id="toc-race" class="nav-link" data-scroll-target="#race">Race</a></li>
  <li><a href="#socio-economic-status" id="toc-socio-economic-status" class="nav-link" data-scroll-target="#socio-economic-status">Socio-economic status</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#inferential-statistics-linear-regression" id="toc-inferential-statistics-linear-regression" class="nav-link" data-scroll-target="#inferential-statistics-linear-regression">Inferential Statistics: Linear Regression</a>
  <ul class="collapse">
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  <li><a href="#iid-errors-and-normality-of-residuals" id="toc-iid-errors-and-normality-of-residuals" class="nav-link" data-scroll-target="#iid-errors-and-normality-of-residuals">IID Errors and Normality of Residuals</a></li>
  <li><a href="#linearity" id="toc-linearity" class="nav-link" data-scroll-target="#linearity">Linearity</a></li>
  <li><a href="#homoscedasticity" id="toc-homoscedasticity" class="nav-link" data-scroll-target="#homoscedasticity">Homoscedasticity</a></li>
  <li><a href="#partial-regression-plots" id="toc-partial-regression-plots" class="nav-link" data-scroll-target="#partial-regression-plots">Partial regression plots</a></li>
  <li><a href="#interpretation-of-results" id="toc-interpretation-of-results" class="nav-link" data-scroll-target="#interpretation-of-results">Interpretation of Results</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/2021-06-13-test-paper.jfif" class="img-fluid figure-img"></p>
</figure>
</div>
<center>
<a href="https://unsplash.com/photos/qDgTQOYk6B8">Unsplash | Nguyen Dang Hoang Nhu</a>
</center>
<section id="overview" class="level1">
<h1>Overview</h1>
<p><em>Updated on July 21, 2021.</em></p>
<p>The <a href="https://collegereadiness.collegeboard.org/sat">SAT</a>, or Scholastic Assessment Test, is taken by many high school students in the USA and around the world before college applications. SAT scores are one of the kinds of information used by colleges to determine a student’s level of college readiness.</p>
<p>However, the SAT has faced controversy due to analyses which have shown that students’ demographics - such as sex, race, socio-economic status - may have <a href="https://www.brookings.edu/research/race-gaps-in-sat-scores-highlight-inequality-and-hinder-upward-mobility/">influenced their SAT performance</a>.</p>
<p>Thus, the goal of this project is to determine the ways in which New York City high school students’ demographics may affect SAT performance. Towards this end, we have:</p>
<ul>
<li>Downloaded various datasets on NYC high schools from <a href="https://opendata.cityofnewyork.us/">NYC Open Data</a></li>
<li>Cleaned, transformed, and combined these datasets into one DataFrame</li>
<li>Conducted exploratory data analysis and visualizations</li>
<li>Performed multiple linear regression</li>
</ul>
<p>The final regression model explained 78.6% of the variance (R2= 0.786, F(6, 394) = 96.44, p &lt; 0.01). The percentage of each race in a school significantly predicted each school’s average SAT score.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I wrote this notebook for the <a href="https://www.dataquest.io/">Dataquest</a> course’s <a href="https://app.dataquest.io/m/217/guided-project%3A-analyzing-nyc-high-school-data/6/next-steps">Guided Project: Analyzing NYC High School Data</a>. The general project flow and research questions came from Dataquest. However, all of the text and code here are written by me unless stated otherwise.</p>
</div>
</div>
</section>
<section id="package-installs" class="level1">
<h1>Package Installs</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.stats.api <span class="im">as</span> sms</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-transformation-and-cleaning" class="level1">
<h1>Data Transformation and Cleaning</h1>
<p>In this section, we transform some columns in each dataset in order to get useful values. Then, we combine all of the datasets into one DataFrame. Some data cleaning will also be performed throughout the process. This is necessary in order to perform analysis using all of the columns available.</p>
<section id="list-of-datasets" class="level2">
<h2 class="anchored" data-anchor-id="list-of-datasets">List of Datasets</h2>
<p>The following are the datasets that were downloaded from NYC Open Data for this project. The files were renamed to have shorter names.</p>
<ul>
<li><code>sat_results.csv</code>: 2012 SAT results <a href="https://data.cityofnewyork.us/Education/2012-SAT-Results/f9bf-2cp4">(link)</a></li>
<li><code>hs_directory</code>: 2010 - 2011 School Attendance and Enrollment Statistics by District <a href="https://data.cityofnewyork.us/Education/2010-2011-School-Attendance-and-Enrollment-Statist/7z8d-msnt">(link)</a></li>
<li><code>class_size.csv</code>: 2010-2011 Class Size - School-level detail <a href="https://data.cityofnewyork.us/Education/2010-2011-Class-Size-School-level-detail/urz7-pzb3">(link)</a></li>
<li><code>ap_2010.csv</code>: 2010 AP (College Board) School Level Results <a href="https://data.cityofnewyork.us/Education/2010-AP-College-Board-School-Level-Results/itfs-ms3e">(link)</a></li>
<li><code>graduation.csv</code>: 2005-2010 Graduation Outcomes - School Level <a href="https://data.cityofnewyork.us/Education/2005-2010-Graduation-Outcomes-School-Level/vh2h-md7a">(link)</a></li>
<li><code>demographics.csv</code>: 2006 - 2012 School Demographics and Accountability Snapshot <a href="https://data.cityofnewyork.us/Education/2006-2012-School-Demographics-and-Accountability-S/ihfw-zy9j">(link)</a></li>
<li><code>survey_all.txt</code>, <code>survey_d75.txt</code>: 2011 NYC School Survey <a href="https://data.cityofnewyork.us/Education/2011-NYC-School-Survey/mnz3-dyi8">(link)</a></li>
</ul>
<p>The code below reads the CSVs into the program.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data_files <span class="op">=</span> [</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ap_2010.csv"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"class_size.csv"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"demographics.csv"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"graduation.csv"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hs_directory.csv"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sat_results.csv"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> {}</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> data_files:</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    key <span class="op">=</span> filename[:<span class="op">-</span><span class="dv">4</span>] <span class="co"># Remove ".csv"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">"./private/2021-06-13-HSD-Files/"</span> <span class="op">+</span> filename)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename "dbn" to "DBN".</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        {<span class="st">"dbn"</span>: <span class="st">"DBN"</span>},</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign the DataFrame to a key in the dictionary.</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    data[key] <span class="op">=</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As for the TXT files, these are tab-delimited and encoded using Windows-1252 encoding, so we have to specify that when we read them in. We will also concatenate these two datasets vertically because these have the same column names.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey data on all community schools.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>all_survey <span class="op">=</span> pd.read_csv(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"./private/2021-06-13-HSD-Files/survey_all.txt"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    delimiter <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    encoding <span class="op">=</span> <span class="st">"windows-1252"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey data on all District 75 schools.</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>d75_survey <span class="op">=</span> pd.read_csv(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"./private/2021-06-13-HSD-Files/survey_d75.txt"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    delimiter <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    encoding <span class="op">=</span> <span class="st">"windows-1252"</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate the two datasets vertically into one dataset.</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>survey <span class="op">=</span> pd.concat(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    [all_survey, d75_survey],</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename "dbn" column to "DBN" for consistency.</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>survey <span class="op">=</span> survey.rename(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"dbn"</span>: <span class="st">"DBN"</span>},</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Put the DataFrame into the main dictionary.</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"survey"</span>] <span class="op">=</span> survey</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, all of the datasets can be accessed via the <code>data</code> Series.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.Series(data)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(data.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>['ap_2010',
 'class_size',
 'demographics',
 'graduation',
 'hs_directory',
 'sat_results',
 'survey']</code></pre>
</div>
</div>
<p>To give an idea of what these datasets look like, we show the first few rows of the SAT results dataset below.</p>
<ul>
<li>Each row contains data on one school.</li>
<li>Each column provides a different detail about the schools, such as school name, number of test takers in each school, etc.</li>
</ul>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data.sat_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">Num of SAT Test Takers</th>
<th data-quarto-table-cell-role="th">SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Writing Avg. Score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL STUDIES</td>
<td>29</td>
<td>355</td>
<td>404</td>
<td>363</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>91</td>
<td>383</td>
<td>423</td>
<td>366</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>70</td>
<td>377</td>
<td>402</td>
<td>370</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M458</td>
<td>FORSYTH SATELLITE ACADEMY</td>
<td>7</td>
<td>414</td>
<td>401</td>
<td>359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>44</td>
<td>390</td>
<td>433</td>
<td>384</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sat-total-scores" class="level2">
<h2 class="anchored" data-anchor-id="sat-total-scores">SAT Total Scores</h2>
<p>The SAT results dataset contains columns showing the average score in each section of the test.</p>
<p>However, there is no column representing the average SAT total score. This is important to know because it gauges a student’s overall mastery of high school knowledge and college preparedness.</p>
<p>Thus, we will generate a total score column by taking the sum of the three section score columns.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>score_cols <span class="op">=</span> [</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAT Math Avg. Score"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAT Critical Reading Avg. Score"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAT Writing Avg. Score"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert each column from string to numeric.</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> score_cols:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    data.sat_results[col] <span class="op">=</span> pd.to_numeric(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        data.sat_results[col],</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        errors <span class="op">=</span> <span class="st">"coerce"</span>, <span class="co"># Set invalid parsing as NaN.</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the total scores by summing the 3 section scores.</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>data.sat_results[<span class="st">"sat_score"</span>] <span class="op">=</span> (</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    data.sat_results[score_cols]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        skipna <span class="op">=</span> <span class="va">False</span>, <span class="co"># Return NaN if the row has a NaN.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with missing values.</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>data.sat_results.dropna(inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>data.sat_results[score_cols <span class="op">+</span> [<span class="st">"sat_score"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Writing Avg. Score</th>
<th data-quarto-table-cell-role="th">sat_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>404.0</td>
<td>355.0</td>
<td>363.0</td>
<td>1122.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>423.0</td>
<td>383.0</td>
<td>366.0</td>
<td>1172.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>402.0</td>
<td>377.0</td>
<td>370.0</td>
<td>1149.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>401.0</td>
<td>414.0</td>
<td>359.0</td>
<td>1174.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>433.0</td>
<td>390.0</td>
<td>384.0</td>
<td>1207.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>sat_score</code> column now shows each school’s average SAT total score.</p>
</section>
<section id="school-location" class="level2">
<h2 class="anchored" data-anchor-id="school-location">School Location</h2>
<p>Another piece of information we want to find is the set of geographical coordinates of each NYC school. We can find this using the <code>hs_directory</code> dataset, which has a <code>Location 1</code> column.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data.hs_directory[[<span class="st">"DBN"</span>, <span class="st">"school_name"</span>, <span class="st">"Location 1"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">school_name</th>
<th data-quarto-table-cell-role="th">Location 1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>17K548</td>
<td>Brooklyn School for Music &amp; Theatre</td>
<td>883 Classon Avenue\nBrooklyn, NY 11225\n(40.67...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>09X543</td>
<td>High School for Violin and Dance</td>
<td>1110 Boston Road\nBronx, NY 10456\n(40.8276026...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>09X327</td>
<td>Comprehensive Model School Project M.S. 327</td>
<td>1501 Jerome Avenue\nBronx, NY 10452\n(40.84241...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>02M280</td>
<td>Manhattan Early College School for Advertising</td>
<td>411 Pearl Street\nNew York, NY 10038\n(40.7106...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>28Q680</td>
<td>Queens Gateway to Health Sciences Secondary Sc...</td>
<td>160-20 Goethals Avenue\nJamaica, NY 11432\n(40...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s inspect the first value in this column to see its format.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.hs_directory.loc[<span class="dv">0</span>, <span class="st">"Location 1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>883 Classon Avenue
Brooklyn, NY 11225
(40.67029890700047, -73.96164787599963)</code></pre>
</div>
</div>
<p>Each value is a string with three lines. The third line contains the school’s latitude and longitude in parentheses.</p>
<p>We can extract the coordinate data using the regular expression <code>\((.+)\)</code>. This matches a pair of parentheses containing 1 or more characters between them.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_coords(text, which <span class="op">=</span> <span class="dv">0</span>):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Take a string, extract coordinates, and return one of the values."""</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    pattern <span class="op">=</span> <span class="vs">r"\((.+)\)"</span> <span class="co"># Regex</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    extracted <span class="op">=</span> re.findall(pattern, text) <span class="co"># Returns a list of extracted strings</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> extracted[<span class="dv">0</span>].split(<span class="st">", "</span>) <span class="co"># Split string into list of strings</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return one of the coordinates as a float64.</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> np.float64(coords[which])</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Make latitude and longitude columns.</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>data.hs_directory[<span class="st">"lat"</span>] <span class="op">=</span> (</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    data.hs_directory[<span class="st">"Location 1"</span>]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(get_coords, which <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>data.hs_directory[<span class="st">"lon"</span>] <span class="op">=</span> (</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    data.hs_directory[<span class="st">"Location 1"</span>]</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(get_coords, which <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>data.hs_directory[[<span class="st">"lat"</span>, <span class="st">"lon"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">lat</th>
<th data-quarto-table-cell-role="th">lon</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>40.670299</td>
<td>-73.961648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>40.827603</td>
<td>-73.904475</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>40.842414</td>
<td>-73.916162</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>40.710679</td>
<td>-74.000807</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>40.718810</td>
<td>-73.806500</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We have successfully extracted the latitude and longitude from each string.</p>
</section>
<section id="survey-dataset-columns" class="level2">
<h2 class="anchored" data-anchor-id="survey-dataset-columns">Survey Dataset Columns</h2>
<p>Another issue is that there are too many columns in the <code>survey</code> dataset:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data.survey.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>(1702, 2773)</code></pre>
</div>
</div>
<p>There are 2773 columns. The reason is that each column represents a different survey item or option. It appears that the survey had many items.</p>
<p>However, if we look at the <a href="https://data.cityofnewyork.us/Education/2011-NYC-School-Survey/mnz3-dyi8">data dictionary</a>, we can see that there are only a few very important columns:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>important_fields <span class="op">=</span> [</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Unique DBN of each school</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DBN"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Response rates</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rr_s"</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rr_t"</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rr_p"</span>, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N_s"</span>, </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N_t"</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N_p"</span>, </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Scores about various aspects of the school experience</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"saf_p_11"</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com_p_11"</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eng_p_11"</span>, </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aca_p_11"</span>, </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"saf_t_11"</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com_t_11"</span>, </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eng_t_11"</span>, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aca_t_11"</span>, </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"saf_s_11"</span>, </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com_s_11"</span>, </span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eng_s_11"</span>, </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aca_s_11"</span>, </span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"saf_tot_11"</span>, </span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"com_tot_11"</span>, </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"eng_tot_11"</span>, </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"aca_tot_11"</span>,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Thus, we will only keep these columns in <code>survey</code> and remove the rest.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data.survey <span class="op">=</span> data.survey[important_fields]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dbn-column" class="level2">
<h2 class="anchored" data-anchor-id="dbn-column">DBN Column</h2>
<p>Earlier, we saw that the first column in the <code>sat_results</code> dataset was <code>DBN</code>.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data.sat_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">Num of SAT Test Takers</th>
<th data-quarto-table-cell-role="th">SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">SAT Writing Avg. Score</th>
<th data-quarto-table-cell-role="th">sat_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL STUDIES</td>
<td>29</td>
<td>355.0</td>
<td>404.0</td>
<td>363.0</td>
<td>1122.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>91</td>
<td>383.0</td>
<td>423.0</td>
<td>366.0</td>
<td>1172.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>70</td>
<td>377.0</td>
<td>402.0</td>
<td>370.0</td>
<td>1149.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M458</td>
<td>FORSYTH SATELLITE ACADEMY</td>
<td>7</td>
<td>414.0</td>
<td>401.0</td>
<td>359.0</td>
<td>1174.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>44</td>
<td>390.0</td>
<td>433.0</td>
<td>384.0</td>
<td>1207.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The DBN, or <a href="https://teachnyc.zendesk.com/hc/en-us/articles/360053601831-What-is-a-DBN-District-Borough-Number-">District Borough Number</a>, is a unique code that identifies each school in NYC.</p>
<p>Since it is unique to each school, we can use it to match rows across our datasets and combine them into one. However, the <code>class_size</code> dataset doesn’t have a DBN column.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data.class_size.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">BOROUGH</th>
<th data-quarto-table-cell-role="th">SCHOOL CODE</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">GRADE</th>
<th data-quarto-table-cell-role="th">PROGRAM TYPE</th>
<th data-quarto-table-cell-role="th">CORE SUBJECT (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">CORE COURSE (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">SERVICE CATEGORY(K-9* ONLY)</th>
<th data-quarto-table-cell-role="th">NUMBER OF STUDENTS / SEATS FILLED</th>
<th data-quarto-table-cell-role="th">NUMBER OF SECTIONS</th>
<th data-quarto-table-cell-role="th">AVERAGE CLASS SIZE</th>
<th data-quarto-table-cell-role="th">SIZE OF SMALLEST CLASS</th>
<th data-quarto-table-cell-role="th">SIZE OF LARGEST CLASS</th>
<th data-quarto-table-cell-role="th">DATA SOURCE</th>
<th data-quarto-table-cell-role="th">SCHOOLWIDE PUPIL-TEACHER RATIO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>19.0</td>
<td>1.0</td>
<td>19.0</td>
<td>19.0</td>
<td>19.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>21.0</td>
<td>1.0</td>
<td>21.0</td>
<td>21.0</td>
<td>21.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>02</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>15.0</td>
<td>1.0</td>
<td>15.0</td>
<td>15.0</td>
<td>15.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By comparing the <code>sat_results</code> dataset to the <code>class_size</code> dataset, we can see that the DBN is actually a combination of:</p>
<ul>
<li>the CSD (Community School District), like “01”.</li>
<li>the School Code, like “M015”.</li>
</ul>
<p>The CSD must have two digits, so single-digit CSDs need to be padded with a zero in front. This is done below.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> zero_pad(num):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Zero-pad a number if it only has 1 digit."""</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    digits <span class="op">=</span> <span class="bu">len</span>(<span class="bu">str</span>(num))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> digits <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        zero_padded <span class="op">=</span> <span class="bu">str</span>(num).zfill(<span class="dv">2</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> zero_padded</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> digits <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">str</span>(num)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Invalid number of digits."</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"padded_csd"</span>] <span class="op">=</span> data.class_size[<span class="st">"CSD"</span>].<span class="bu">apply</span>(zero_pad)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>data.class_size[[<span class="st">"CSD"</span>, <span class="st">"padded_csd"</span>, <span class="st">"SCHOOL CODE"</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">padded_csd</th>
<th data-quarto-table-cell-role="th">SCHOOL CODE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>01</td>
<td>M015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>01</td>
<td>M015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>01</td>
<td>M015</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>01</td>
<td>M015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>01</td>
<td>M015</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, we can combine <code>padded_csd</code> and <code>SCHOOL CODE</code> to make the DBN.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"DBN"</span>] <span class="op">=</span> (</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    data.class_size[[<span class="st">"padded_csd"</span>, <span class="st">"SCHOOL CODE"</span>]]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>) <span class="co"># Add values along rows.</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the df so that DBN is in front.</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reorder_columns(df, first_cols):</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Take a DataFrame and a list of columns. Move those columns to the left side. Return the new DataFrame."""</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df[</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        first_cols</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> df <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> first_cols]</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>data.class_size <span class="op">=</span> reorder_columns(data.class_size, [<span class="st">"DBN"</span>])</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove padded_csd column</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>data.class_size.drop(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"padded_csd"</span>,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    inplace <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>data.class_size.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">BOROUGH</th>
<th data-quarto-table-cell-role="th">SCHOOL CODE</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">GRADE</th>
<th data-quarto-table-cell-role="th">PROGRAM TYPE</th>
<th data-quarto-table-cell-role="th">CORE SUBJECT (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">CORE COURSE (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">SERVICE CATEGORY(K-9* ONLY)</th>
<th data-quarto-table-cell-role="th">NUMBER OF STUDENTS / SEATS FILLED</th>
<th data-quarto-table-cell-role="th">NUMBER OF SECTIONS</th>
<th data-quarto-table-cell-role="th">AVERAGE CLASS SIZE</th>
<th data-quarto-table-cell-role="th">SIZE OF SMALLEST CLASS</th>
<th data-quarto-table-cell-role="th">SIZE OF LARGEST CLASS</th>
<th data-quarto-table-cell-role="th">DATA SOURCE</th>
<th data-quarto-table-cell-role="th">SCHOOLWIDE PUPIL-TEACHER RATIO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>19.0</td>
<td>1.0</td>
<td>19.0</td>
<td>19.0</td>
<td>19.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>21.0</td>
<td>1.0</td>
<td>21.0</td>
<td>21.0</td>
<td>21.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>02</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>15.0</td>
<td>1.0</td>
<td>15.0</td>
<td>15.0</td>
<td>15.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We were successful in creating a <code>DBN</code> column for the class size dataset.</p>
</section>
<section id="condensing-datasets" class="level2">
<h2 class="anchored" data-anchor-id="condensing-datasets">Condensing Datasets</h2>
<p>Another issue that needs to be addressed is that some datasets have <strong>multiple rows with the same DBN</strong>. For example, look at the frequency table of DBN values in <code>class_size</code>.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"DBN"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>15K429    57
09X505    56
09X517    56
21K690    52
15K448    52
          ..
27Q273     3
03M452     3
09X090     2
27Q465     2
02M267     2
Name: DBN, Length: 1487, dtype: int64</code></pre>
</div>
</div>
<p>Each DBN appears at least twice in the dataset. This would be problematic when merging it with other datasets, since each row must have a unique DBN value.</p>
<p>Therefore, we need to <strong>condense</strong> <code>class_size</code> and other such datasets so that the DBN value is unique to each row.</p>
<p>The code below identifies which columns need to be condensed based on the frequency of its DBN values.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    df_name</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df_name <span class="kw">in</span> data.index</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[df_name][<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>() <span class="op">&gt;</span> <span class="dv">1</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if any DBN values appear more than once.</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>['ap_2010', 'class_size', 'demographics', 'graduation']</code></pre>
</div>
</div>
<p>The 4 datasets listed above will be condensed one by one.</p>
<section id="advanced-placement-dataset" class="level3">
<h3 class="anchored" data-anchor-id="advanced-placement-dataset">Advanced Placement Dataset</h3>
<p>First, the <code>ap_2010</code> dataset will be condensed. It contains data on AP (Advanced Placement) test results in 2010.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.ap_2010.shape)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>data.ap_2010.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(258, 5)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">SchoolName</th>
<th data-quarto-table-cell-role="th">AP Test Takers</th>
<th data-quarto-table-cell-role="th">Total Exams Taken</th>
<th data-quarto-table-cell-role="th">Number of Exams with scores 3 4 or 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD H.S.</td>
<td>39</td>
<td>49</td>
<td>10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY HS</td>
<td>19</td>
<td>21</td>
<td>s</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M515</td>
<td>LOWER EASTSIDE PREP</td>
<td>24</td>
<td>26</td>
<td>24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M539</td>
<td>NEW EXPLORATIONS SCI,TECH,MATH</td>
<td>255</td>
<td>377</td>
<td>191</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>02M296</td>
<td>High School of Hospitality Management</td>
<td>s</td>
<td>s</td>
<td>s</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>From the first five rows, it is not immediately clear why DBN values repeat. The DBNs are unique in this sample.</p>
<p>Let’s check the frequency table of DBN values.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>data.ap_2010[<span class="st">"DBN"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>04M610    2
01M448    1
19K507    1
17K528    1
17K537    1
         ..
09X329    1
09X365    1
09X412    1
09X414    1
32K556    1
Name: DBN, Length: 257, dtype: int64</code></pre>
</div>
</div>
<p>This frequency table is ordered by frequency, descending. Thus, we can tell that <code>04M610</code> is the only DBN that repeats in this dataset. Let’s inspect the 2 rows with this DBN.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>data.ap_2010.loc[</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    data.ap_2010[<span class="st">"DBN"</span>] <span class="op">==</span> <span class="st">"04M610"</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">SchoolName</th>
<th data-quarto-table-cell-role="th">AP Test Takers</th>
<th data-quarto-table-cell-role="th">Total Exams Taken</th>
<th data-quarto-table-cell-role="th">Number of Exams with scores 3 4 or 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>04M610</td>
<td>THE YOUNG WOMEN'S LEADERSHIP SCHOOL OF EAST HA...</td>
<td>41</td>
<td>55</td>
<td>29</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">52</td>
<td>04M610</td>
<td>YOUNG WOMEN'S LEADERSHIP SCH</td>
<td>s</td>
<td>s</td>
<td>s</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>It looks like the duplication was caused by a simple error in data entry. Row 51 is valid, whereas row 52 has an incomplete school name. It also has a string “s” in numerical columns; this is invalid data.</p>
<p>Thus, we will drop row 52 from the dataset.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data.ap_2010.drop(<span class="dv">52</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>data.ap_2010[<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>1</code></pre>
</div>
</div>
<p>Now that we’ve dropped the inaccurate row, none of the DBN values repeat.</p>
<p>As a side note, since there were “s” strings in the numerical columns, we realize that these are <strong>object-type</strong> columns. Thus, we have to convert these into numerical columns in order to perform analysis on them later on.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">'AP Test Takers '</span>, <span class="st">'Total Exams Taken'</span>, <span class="st">'Number of Exams with scores 3 4 or 5'</span>]</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> cols:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert each column to numerical format.</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    data.ap_2010[col] <span class="op">=</span> pd.to_numeric(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        data.ap_2010[col],</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        errors <span class="op">=</span> <span class="st">"coerce"</span>, <span class="co"># In case of errors, use NaN values.</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>data.ap_2010.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>DBN                                      object
SchoolName                               object
AP Test Takers                          float64
Total Exams Taken                       float64
Number of Exams with scores 3 4 or 5    float64
dtype: object</code></pre>
</div>
</div>
<p>The numerical columns were successfully converted into <code>float64</code> (decimal) format.</p>
</section>
<section id="class-size-dataset" class="level3">
<h3 class="anchored" data-anchor-id="class-size-dataset">Class Size Dataset</h3>
<p>Next, we will condense the <code>class_size</code> dataset. It contains aggregated data on the number of students in classes in NYC schools.</p>
<p>Why are there rows with duplicate DBNs? Let’s look at the first few rows.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.class_size.shape)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>data.class_size.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(27611, 17)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">BOROUGH</th>
<th data-quarto-table-cell-role="th">SCHOOL CODE</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">GRADE</th>
<th data-quarto-table-cell-role="th">PROGRAM TYPE</th>
<th data-quarto-table-cell-role="th">CORE SUBJECT (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">CORE COURSE (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">SERVICE CATEGORY(K-9* ONLY)</th>
<th data-quarto-table-cell-role="th">NUMBER OF STUDENTS / SEATS FILLED</th>
<th data-quarto-table-cell-role="th">NUMBER OF SECTIONS</th>
<th data-quarto-table-cell-role="th">AVERAGE CLASS SIZE</th>
<th data-quarto-table-cell-role="th">SIZE OF SMALLEST CLASS</th>
<th data-quarto-table-cell-role="th">SIZE OF LARGEST CLASS</th>
<th data-quarto-table-cell-role="th">DATA SOURCE</th>
<th data-quarto-table-cell-role="th">SCHOOLWIDE PUPIL-TEACHER RATIO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>19.0</td>
<td>1.0</td>
<td>19.0</td>
<td>19.0</td>
<td>19.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>0K</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>21.0</td>
<td>1.0</td>
<td>21.0</td>
<td>21.0</td>
<td>21.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>01</td>
<td>CTT</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>17.0</td>
<td>1.0</td>
<td>17.0</td>
<td>17.0</td>
<td>17.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M015</td>
<td>1</td>
<td>M</td>
<td>M015</td>
<td>P.S. 015 Roberto Clemente</td>
<td>02</td>
<td>GEN ED</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>15.0</td>
<td>1.0</td>
<td>15.0</td>
<td>15.0</td>
<td>15.0</td>
<td>ATS</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Look at the <code>GRADE</code> and <code>PROGRAM TYPE</code> columns. Each school’s data is split by grade level, from K to 12. The data are further split by the program type (GEN ED, CTT, etc.). That’s why each DBN has multiple rows.</p>
<p>In our case, we are only concerned with high school students’ data (grades 9 to 12) since the SAT is taken at this level of education. Let’s see which <code>GRADE</code> value/s correspond to high school.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"GRADE "</span>].value_counts().sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>01          1185
02          1167
03          1143
04          1140
05          1086
06           846
07           778
08           735
09            20
09-12      10644
0K          1237
0K-09       1384
MS Core     4762
Name: GRADE , dtype: int64</code></pre>
</div>
</div>
<p>Conveniently, there is a <code>09-12</code> value. Rows with this value would contain aggregated data on all high school grade levels. Thus, we will filter the <code>class_size</code> dataset to keep only these rows.</p>
<p>There is still the issue of the <code>PROGRAM TYPE</code> column, however. Let’s look at its frequency table.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"PROGRAM TYPE"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>GEN ED     14545
CTT         7460
SPEC ED     3653
G&amp;T          469
Name: PROGRAM TYPE, dtype: int64</code></pre>
</div>
</div>
<p>There are hundreds or thousands of rows under each program type. According to the <a href="https://data.cityofnewyork.us/Education/2010-2011-Class-Size-School-level-detail/urz7-pzb3">data dictionary</a>, the following are the meanings of these values:</p>
<ul>
<li><code>GEN ED</code>: General Education</li>
<li><code>CTT</code>: Collaborative Team Teaching</li>
<li><code>SPEC ED</code>: Special Education</li>
<li><code>G&amp;T</code>: Gifted &amp; Talented</li>
</ul>
<p>The General Education program best represents the majority of high school students, and this is the most frequent program in the data. Thus, we will keep the <code>GEN ED</code> rows and drop the rest.</p>
<p>To recap, we chose to filter the dataset to keep rows where the grade level is from 9 to 12 and the program type is General Education. We will do this using the code below.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data.class_size <span class="op">=</span> data.class_size.loc[</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    (data.class_size[<span class="st">"GRADE "</span>] <span class="op">==</span> <span class="st">"09-12"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&amp;</span> (data.class_size[<span class="st">"PROGRAM TYPE"</span>] <span class="op">==</span> <span class="st">"GEN ED"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.class_size.shape)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>data.class_size.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(6513, 17)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">BOROUGH</th>
<th data-quarto-table-cell-role="th">SCHOOL CODE</th>
<th data-quarto-table-cell-role="th">SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">GRADE</th>
<th data-quarto-table-cell-role="th">PROGRAM TYPE</th>
<th data-quarto-table-cell-role="th">CORE SUBJECT (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">CORE COURSE (MS CORE and 9-12 ONLY)</th>
<th data-quarto-table-cell-role="th">SERVICE CATEGORY(K-9* ONLY)</th>
<th data-quarto-table-cell-role="th">NUMBER OF STUDENTS / SEATS FILLED</th>
<th data-quarto-table-cell-role="th">NUMBER OF SECTIONS</th>
<th data-quarto-table-cell-role="th">AVERAGE CLASS SIZE</th>
<th data-quarto-table-cell-role="th">SIZE OF SMALLEST CLASS</th>
<th data-quarto-table-cell-role="th">SIZE OF LARGEST CLASS</th>
<th data-quarto-table-cell-role="th">DATA SOURCE</th>
<th data-quarto-table-cell-role="th">SCHOOLWIDE PUPIL-TEACHER RATIO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">225</td>
<td>01M292</td>
<td>1</td>
<td>M</td>
<td>M292</td>
<td>Henry Street School for International Studies</td>
<td>09-12</td>
<td>GEN ED</td>
<td>ENGLISH</td>
<td>English 9</td>
<td>-</td>
<td>63.0</td>
<td>3.0</td>
<td>21.0</td>
<td>19.0</td>
<td>25.0</td>
<td>STARS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">226</td>
<td>01M292</td>
<td>1</td>
<td>M</td>
<td>M292</td>
<td>Henry Street School for International Studies</td>
<td>09-12</td>
<td>GEN ED</td>
<td>ENGLISH</td>
<td>English 10</td>
<td>-</td>
<td>79.0</td>
<td>3.0</td>
<td>26.3</td>
<td>24.0</td>
<td>31.0</td>
<td>STARS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">227</td>
<td>01M292</td>
<td>1</td>
<td>M</td>
<td>M292</td>
<td>Henry Street School for International Studies</td>
<td>09-12</td>
<td>GEN ED</td>
<td>ENGLISH</td>
<td>English 11</td>
<td>-</td>
<td>38.0</td>
<td>2.0</td>
<td>19.0</td>
<td>16.0</td>
<td>22.0</td>
<td>STARS</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">228</td>
<td>01M292</td>
<td>1</td>
<td>M</td>
<td>M292</td>
<td>Henry Street School for International Studies</td>
<td>09-12</td>
<td>GEN ED</td>
<td>ENGLISH</td>
<td>English 12</td>
<td>-</td>
<td>69.0</td>
<td>3.0</td>
<td>23.0</td>
<td>13.0</td>
<td>30.0</td>
<td>STARS</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">229</td>
<td>01M292</td>
<td>1</td>
<td>M</td>
<td>M292</td>
<td>Henry Street School for International Studies</td>
<td>09-12</td>
<td>GEN ED</td>
<td>MATH</td>
<td>Integrated Algebra</td>
<td>-</td>
<td>53.0</td>
<td>3.0</td>
<td>17.7</td>
<td>16.0</td>
<td>21.0</td>
<td>STARS</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The first few rows of the dataset show us that we were successful in filtering rows by <code>GRADE</code> and <code>PROGRAM TYPE</code>. From 27611 rows, we have narrowed the dataset down to 6513 rows.</p>
<p>However, there are still duplicate DBN values. The new problem is that the data are divided by the following columns:</p>
<ul>
<li><code>CORE SUBJECT (MS CORE and 9-12 ONLY)</code></li>
<li><code>CORE COURSE (MS CORE and 9-12 ONLY)</code></li>
</ul>
<p>These columns contain the specific subject or course of the class. We want to get class size data that accounts for all subjects, so we cannot simply filter the dataset by 1 subject.</p>
<p>Instead, we will:</p>
<ul>
<li>Group the data by DBN value.</li>
<li>Aggregate the numerical data by <strong>taking the mean</strong> of each column in each group.</li>
</ul>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>data.class_size <span class="op">=</span> (</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    data.class_size</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">"DBN"</span>) <span class="co"># Group by the school's unique DBN</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    .agg(np.mean) <span class="co"># Aggregate numerical columns using mean</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    .reset_index() <span class="co"># Put the DBN column back in the df</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.class_size.shape)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>data.class_size.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(583, 8)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">CSD</th>
<th data-quarto-table-cell-role="th">NUMBER OF STUDENTS / SEATS FILLED</th>
<th data-quarto-table-cell-role="th">NUMBER OF SECTIONS</th>
<th data-quarto-table-cell-role="th">AVERAGE CLASS SIZE</th>
<th data-quarto-table-cell-role="th">SIZE OF SMALLEST CLASS</th>
<th data-quarto-table-cell-role="th">SIZE OF LARGEST CLASS</th>
<th data-quarto-table-cell-role="th">SCHOOLWIDE PUPIL-TEACHER RATIO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M292</td>
<td>1.0</td>
<td>88.0000</td>
<td>4.000000</td>
<td>22.564286</td>
<td>18.50</td>
<td>26.571429</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M332</td>
<td>1.0</td>
<td>46.0000</td>
<td>2.000000</td>
<td>22.000000</td>
<td>21.00</td>
<td>23.500000</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M378</td>
<td>1.0</td>
<td>33.0000</td>
<td>1.000000</td>
<td>33.000000</td>
<td>33.00</td>
<td>33.000000</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M448</td>
<td>1.0</td>
<td>105.6875</td>
<td>4.750000</td>
<td>22.231250</td>
<td>18.25</td>
<td>27.062500</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M450</td>
<td>1.0</td>
<td>57.6000</td>
<td>2.733333</td>
<td>21.200000</td>
<td>19.40</td>
<td>22.866667</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The following changes have occurred:</p>
<ul>
<li>The dataset now has only 583 rows.</li>
<li>Only the DBN, CSD, and numerical columns remain.</li>
<li>The numerical columns contain decimals since the data were aggregated.</li>
</ul>
<p>Let’s check what the <strong>maximum frequency</strong> of DBN values is.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data.class_size[<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>1</code></pre>
</div>
</div>
<p>Each DBN only <strong>appears once</strong> in the data. We have condensed the dataset successfully.</p>
</section>
<section id="demographics-dataset" class="level3">
<h3 class="anchored" data-anchor-id="demographics-dataset">Demographics Dataset</h3>
<p>Next, we condense the Demographics dataset. It contains data on NYC high school students’ grade level, gender, ethnicity, etc. from 2006 to 2012.</p>
<p>Let’s try to identify why each DBN has multiple rows.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.demographics.shape)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>data.demographics.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(10075, 38)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">schoolyear</th>
<th data-quarto-table-cell-role="th">fl_percent</th>
<th data-quarto-table-cell-role="th">frl_percent</th>
<th data-quarto-table-cell-role="th">total_enrollment</th>
<th data-quarto-table-cell-role="th">prek</th>
<th data-quarto-table-cell-role="th">k</th>
<th data-quarto-table-cell-role="th">grade1</th>
<th data-quarto-table-cell-role="th">grade2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">black_num</th>
<th data-quarto-table-cell-role="th">black_per</th>
<th data-quarto-table-cell-role="th">hispanic_num</th>
<th data-quarto-table-cell-role="th">hispanic_per</th>
<th data-quarto-table-cell-role="th">white_num</th>
<th data-quarto-table-cell-role="th">white_per</th>
<th data-quarto-table-cell-role="th">male_num</th>
<th data-quarto-table-cell-role="th">male_per</th>
<th data-quarto-table-cell-role="th">female_num</th>
<th data-quarto-table-cell-role="th">female_per</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20052006</td>
<td>89.4</td>
<td>NaN</td>
<td>281</td>
<td>15</td>
<td>36</td>
<td>40</td>
<td>33</td>
<td>...</td>
<td>74</td>
<td>26.3</td>
<td>189</td>
<td>67.3</td>
<td>5</td>
<td>1.8</td>
<td>158.0</td>
<td>56.2</td>
<td>123.0</td>
<td>43.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20062007</td>
<td>89.4</td>
<td>NaN</td>
<td>243</td>
<td>15</td>
<td>29</td>
<td>39</td>
<td>38</td>
<td>...</td>
<td>68</td>
<td>28.0</td>
<td>153</td>
<td>63.0</td>
<td>4</td>
<td>1.6</td>
<td>140.0</td>
<td>57.6</td>
<td>103.0</td>
<td>42.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20072008</td>
<td>89.4</td>
<td>NaN</td>
<td>261</td>
<td>18</td>
<td>43</td>
<td>39</td>
<td>36</td>
<td>...</td>
<td>77</td>
<td>29.5</td>
<td>157</td>
<td>60.2</td>
<td>7</td>
<td>2.7</td>
<td>143.0</td>
<td>54.8</td>
<td>118.0</td>
<td>45.2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20082009</td>
<td>89.4</td>
<td>NaN</td>
<td>252</td>
<td>17</td>
<td>37</td>
<td>44</td>
<td>32</td>
<td>...</td>
<td>75</td>
<td>29.8</td>
<td>149</td>
<td>59.1</td>
<td>7</td>
<td>2.8</td>
<td>149.0</td>
<td>59.1</td>
<td>103.0</td>
<td>40.9</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20092010</td>
<td></td>
<td>96.5</td>
<td>208</td>
<td>16</td>
<td>40</td>
<td>28</td>
<td>32</td>
<td>...</td>
<td>67</td>
<td>32.2</td>
<td>118</td>
<td>56.7</td>
<td>6</td>
<td>2.9</td>
<td>124.0</td>
<td>59.6</td>
<td>84.0</td>
<td>40.4</td>
</tr>
</tbody>
</table>

<p>5 rows × 38 columns</p>
</div>
</div>
</div>
<p>Based on the <code>schoolyear</code> column, each school has a separate row for each academic year. Let’s inspect the years available.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>data.demographics[<span class="st">"schoolyear"</span>].value_counts().sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>20052006    1356
20062007    1386
20072008    1410
20082009    1441
20092010    1475
20102011    1498
20112012    1509
Name: schoolyear, dtype: int64</code></pre>
</div>
</div>
<p>One of the values represents school year 2011-2012. This is relevant to our analysis because the SAT results dataset is from 2012. Thus, we will filter <code>demographics</code> to include only this year.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>data.demographics <span class="op">=</span> data.demographics.loc[</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    data.demographics[<span class="st">"schoolyear"</span>] <span class="op">==</span> <span class="dv">20112012</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.demographics.shape)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>data.demographics.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(1509, 38)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">schoolyear</th>
<th data-quarto-table-cell-role="th">fl_percent</th>
<th data-quarto-table-cell-role="th">frl_percent</th>
<th data-quarto-table-cell-role="th">total_enrollment</th>
<th data-quarto-table-cell-role="th">prek</th>
<th data-quarto-table-cell-role="th">k</th>
<th data-quarto-table-cell-role="th">grade1</th>
<th data-quarto-table-cell-role="th">grade2</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">black_num</th>
<th data-quarto-table-cell-role="th">black_per</th>
<th data-quarto-table-cell-role="th">hispanic_num</th>
<th data-quarto-table-cell-role="th">hispanic_per</th>
<th data-quarto-table-cell-role="th">white_num</th>
<th data-quarto-table-cell-role="th">white_per</th>
<th data-quarto-table-cell-role="th">male_num</th>
<th data-quarto-table-cell-role="th">male_per</th>
<th data-quarto-table-cell-role="th">female_num</th>
<th data-quarto-table-cell-role="th">female_per</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>01M015</td>
<td>P.S. 015 ROBERTO CLEMENTE</td>
<td>20112012</td>
<td>NaN</td>
<td>89.4</td>
<td>189</td>
<td>13</td>
<td>31</td>
<td>35</td>
<td>28</td>
<td>...</td>
<td>63</td>
<td>33.3</td>
<td>109</td>
<td>57.7</td>
<td>4</td>
<td>2.1</td>
<td>97.0</td>
<td>51.3</td>
<td>92.0</td>
<td>48.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>01M019</td>
<td>P.S. 019 ASHER LEVY</td>
<td>20112012</td>
<td>NaN</td>
<td>61.5</td>
<td>328</td>
<td>32</td>
<td>46</td>
<td>52</td>
<td>54</td>
<td>...</td>
<td>81</td>
<td>24.7</td>
<td>158</td>
<td>48.2</td>
<td>28</td>
<td>8.5</td>
<td>147.0</td>
<td>44.8</td>
<td>181.0</td>
<td>55.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>01M020</td>
<td>PS 020 ANNA SILVER</td>
<td>20112012</td>
<td>NaN</td>
<td>92.5</td>
<td>626</td>
<td>52</td>
<td>102</td>
<td>121</td>
<td>87</td>
<td>...</td>
<td>55</td>
<td>8.8</td>
<td>357</td>
<td>57.0</td>
<td>16</td>
<td>2.6</td>
<td>330.0</td>
<td>52.7</td>
<td>296.0</td>
<td>47.3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>01M034</td>
<td>PS 034 FRANKLIN D ROOSEVELT</td>
<td>20112012</td>
<td>NaN</td>
<td>99.7</td>
<td>401</td>
<td>14</td>
<td>34</td>
<td>38</td>
<td>36</td>
<td>...</td>
<td>90</td>
<td>22.4</td>
<td>275</td>
<td>68.6</td>
<td>8</td>
<td>2.0</td>
<td>204.0</td>
<td>50.9</td>
<td>197.0</td>
<td>49.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">35</td>
<td>01M063</td>
<td>PS 063 WILLIAM MCKINLEY</td>
<td>20112012</td>
<td>NaN</td>
<td>78.9</td>
<td>176</td>
<td>18</td>
<td>20</td>
<td>30</td>
<td>21</td>
<td>...</td>
<td>41</td>
<td>23.3</td>
<td>110</td>
<td>62.5</td>
<td>15</td>
<td>8.5</td>
<td>97.0</td>
<td>55.1</td>
<td>79.0</td>
<td>44.9</td>
</tr>
</tbody>
</table>

<p>5 rows × 38 columns</p>
</div>
</div>
</div>
<p>Filtering the dataset has reduced it to 1509 rows. Also, if we look at the DBN column, the values appear to be distinct now. Let’s check the maximum frequency of its values:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data.demographics[<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>1</code></pre>
</div>
</div>
<p>Each DBN value appears only once.</p>
</section>
<section id="graduation-dataset" class="level3">
<h3 class="anchored" data-anchor-id="graduation-dataset">Graduation Dataset</h3>
<p>Lastly, we will condense the graduation dataset. It contains data on the graduation rate in the Cohorts of 2001 to 2006. The cohort of a year is the set of students that entered Grade 9 in that year. Thus, the cohorts in this dataset graduated between 2005 and 2010.</p>
<p>Below are the first five rows of the dataset.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.graduation.shape)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>data.graduation.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(25096, 23)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Demographic</th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">School Name</th>
<th data-quarto-table-cell-role="th">Cohort</th>
<th data-quarto-table-cell-role="th">Total Cohort</th>
<th data-quarto-table-cell-role="th">Total Grads - n</th>
<th data-quarto-table-cell-role="th">Total Grads - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - n</th>
<th data-quarto-table-cell-role="th">Total Regents - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - % of grads</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - n</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of cohort</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of grads</th>
<th data-quarto-table-cell-role="th">Local - n</th>
<th data-quarto-table-cell-role="th">Local - % of cohort</th>
<th data-quarto-table-cell-role="th">Local - % of grads</th>
<th data-quarto-table-cell-role="th">Still Enrolled - n</th>
<th data-quarto-table-cell-role="th">Still Enrolled - % of cohort</th>
<th data-quarto-table-cell-role="th">Dropped Out - n</th>
<th data-quarto-table-cell-role="th">Dropped Out - % of cohort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2003</td>
<td>5</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>...</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
<td>s</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2004</td>
<td>55</td>
<td>37</td>
<td>67.3%</td>
<td>17</td>
<td>30.9%</td>
<td>45.9%</td>
<td>...</td>
<td>17</td>
<td>30.9%</td>
<td>45.9%</td>
<td>20</td>
<td>36.4%</td>
<td>54.1%</td>
<td>15</td>
<td>27.3%</td>
<td>3</td>
<td>5.5%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2005</td>
<td>64</td>
<td>43</td>
<td>67.2%</td>
<td>27</td>
<td>42.2%</td>
<td>62.8%</td>
<td>...</td>
<td>27</td>
<td>42.2%</td>
<td>62.8%</td>
<td>16</td>
<td>25%</td>
<td>37.200000000000003%</td>
<td>9</td>
<td>14.1%</td>
<td>9</td>
<td>14.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2006</td>
<td>78</td>
<td>43</td>
<td>55.1%</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>...</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>7</td>
<td>9%</td>
<td>16.3%</td>
<td>16</td>
<td>20.5%</td>
<td>11</td>
<td>14.1%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2006 Aug</td>
<td>78</td>
<td>44</td>
<td>56.4%</td>
<td>37</td>
<td>47.4%</td>
<td>84.1%</td>
<td>...</td>
<td>37</td>
<td>47.4%</td>
<td>84.1%</td>
<td>7</td>
<td>9%</td>
<td>15.9%</td>
<td>15</td>
<td>19.2%</td>
<td>11</td>
<td>14.1%</td>
</tr>
</tbody>
</table>

<p>5 rows × 23 columns</p>
</div>
</div>
</div>
<p>At first glance, the <code>Cohort</code> column appears to be responsible for the duplication of DBNs. Each school has a separate row for each cohort. Below are the cohort values:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data.graduation[<span class="st">"Cohort"</span>].value_counts().sort_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>2001        2637
2002        3095
2003        3432
2004        3708
2005        3963
2006        4130
2006 Aug    4131
Name: Cohort, dtype: int64</code></pre>
</div>
</div>
<p>As expected, the cohorts range from 2001 to 2006. There also appears to be an extra value representing August of 2006.</p>
<p>Since we can only keep 1 row from each school, it is best to keep the <code>2006</code> rows since these are the most recent.</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data.graduation <span class="op">=</span> data.graduation.loc[</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    data.graduation[<span class="st">"Cohort"</span>] <span class="op">==</span> <span class="st">"2006"</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.graduation.shape)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>data.graduation.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(4130, 23)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Demographic</th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">School Name</th>
<th data-quarto-table-cell-role="th">Cohort</th>
<th data-quarto-table-cell-role="th">Total Cohort</th>
<th data-quarto-table-cell-role="th">Total Grads - n</th>
<th data-quarto-table-cell-role="th">Total Grads - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - n</th>
<th data-quarto-table-cell-role="th">Total Regents - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - % of grads</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - n</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of cohort</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of grads</th>
<th data-quarto-table-cell-role="th">Local - n</th>
<th data-quarto-table-cell-role="th">Local - % of cohort</th>
<th data-quarto-table-cell-role="th">Local - % of grads</th>
<th data-quarto-table-cell-role="th">Still Enrolled - n</th>
<th data-quarto-table-cell-role="th">Still Enrolled - % of cohort</th>
<th data-quarto-table-cell-role="th">Dropped Out - n</th>
<th data-quarto-table-cell-role="th">Dropped Out - % of cohort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2006</td>
<td>78</td>
<td>43</td>
<td>55.1%</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>...</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>7</td>
<td>9%</td>
<td>16.3%</td>
<td>16</td>
<td>20.5%</td>
<td>11</td>
<td>14.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Total Cohort</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>2006</td>
<td>124</td>
<td>53</td>
<td>42.7%</td>
<td>42</td>
<td>33.9%</td>
<td>79.2%</td>
<td>...</td>
<td>34</td>
<td>27.4%</td>
<td>64.2%</td>
<td>11</td>
<td>8.9%</td>
<td>20.8%</td>
<td>46</td>
<td>37.1%</td>
<td>20</td>
<td>16.100000000000001%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Total Cohort</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>2006</td>
<td>90</td>
<td>70</td>
<td>77.8%</td>
<td>67</td>
<td>74.400000000000006%</td>
<td>95.7%</td>
<td>...</td>
<td>67</td>
<td>74.400000000000006%</td>
<td>95.7%</td>
<td>3</td>
<td>3.3%</td>
<td>4.3%</td>
<td>15</td>
<td>16.7%</td>
<td>5</td>
<td>5.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Total Cohort</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>2006</td>
<td>84</td>
<td>47</td>
<td>56%</td>
<td>40</td>
<td>47.6%</td>
<td>85.1%</td>
<td>...</td>
<td>23</td>
<td>27.4%</td>
<td>48.9%</td>
<td>7</td>
<td>8.300000000000001%</td>
<td>14.9%</td>
<td>25</td>
<td>29.8%</td>
<td>5</td>
<td>6%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Total Cohort</td>
<td>01M515</td>
<td>LOWER EAST SIDE PREPARATORY HIGH SCHO</td>
<td>2006</td>
<td>193</td>
<td>105</td>
<td>54.4%</td>
<td>91</td>
<td>47.2%</td>
<td>86.7%</td>
<td>...</td>
<td>22</td>
<td>11.4%</td>
<td>21%</td>
<td>14</td>
<td>7.3%</td>
<td>13.3%</td>
<td>53</td>
<td>27.5%</td>
<td>35</td>
<td>18.100000000000001%</td>
</tr>
</tbody>
</table>

<p>5 rows × 23 columns</p>
</div>
</div>
</div>
<p>The dataset is left with 4130 rows. Let’s check if the DBNs are unique.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data.graduation[<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>13</code></pre>
</div>
</div>
<p>It seems that the DBNs still have up to 13 duplicates each.</p>
<p>This may be due to the <code>Demographic</code> column. What if it contains values other than “Total Cohort”?</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>data.graduation[<span class="st">"Demographic"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>Special Education Students     411
Total Cohort                   405
General Education Students     405
English Proficient Students    401
Female                         396
Hispanic                       395
Male                           395
Black                          394
English Language Learners      340
Asian                          296
White                          292
Name: Demographic, dtype: int64</code></pre>
</div>
</div>
<p>Indeed, each school has a separate row for each demographic. Since we want to include all or most of the students, we will take the “Total Cohort” rows.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data.graduation <span class="op">=</span> data.graduation.loc[</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    data.graduation[<span class="st">"Demographic"</span>] <span class="op">==</span> <span class="st">"Total Cohort"</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data.graduation.shape)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>data.graduation.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(405, 23)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Demographic</th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">School Name</th>
<th data-quarto-table-cell-role="th">Cohort</th>
<th data-quarto-table-cell-role="th">Total Cohort</th>
<th data-quarto-table-cell-role="th">Total Grads - n</th>
<th data-quarto-table-cell-role="th">Total Grads - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - n</th>
<th data-quarto-table-cell-role="th">Total Regents - % of cohort</th>
<th data-quarto-table-cell-role="th">Total Regents - % of grads</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - n</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of cohort</th>
<th data-quarto-table-cell-role="th">Regents w/o Advanced - % of grads</th>
<th data-quarto-table-cell-role="th">Local - n</th>
<th data-quarto-table-cell-role="th">Local - % of cohort</th>
<th data-quarto-table-cell-role="th">Local - % of grads</th>
<th data-quarto-table-cell-role="th">Still Enrolled - n</th>
<th data-quarto-table-cell-role="th">Still Enrolled - % of cohort</th>
<th data-quarto-table-cell-role="th">Dropped Out - n</th>
<th data-quarto-table-cell-role="th">Dropped Out - % of cohort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Total Cohort</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL</td>
<td>2006</td>
<td>78</td>
<td>43</td>
<td>55.1%</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>...</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>7</td>
<td>9%</td>
<td>16.3%</td>
<td>16</td>
<td>20.5%</td>
<td>11</td>
<td>14.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Total Cohort</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>2006</td>
<td>124</td>
<td>53</td>
<td>42.7%</td>
<td>42</td>
<td>33.9%</td>
<td>79.2%</td>
<td>...</td>
<td>34</td>
<td>27.4%</td>
<td>64.2%</td>
<td>11</td>
<td>8.9%</td>
<td>20.8%</td>
<td>46</td>
<td>37.1%</td>
<td>20</td>
<td>16.100000000000001%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Total Cohort</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>2006</td>
<td>90</td>
<td>70</td>
<td>77.8%</td>
<td>67</td>
<td>74.400000000000006%</td>
<td>95.7%</td>
<td>...</td>
<td>67</td>
<td>74.400000000000006%</td>
<td>95.7%</td>
<td>3</td>
<td>3.3%</td>
<td>4.3%</td>
<td>15</td>
<td>16.7%</td>
<td>5</td>
<td>5.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Total Cohort</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>2006</td>
<td>84</td>
<td>47</td>
<td>56%</td>
<td>40</td>
<td>47.6%</td>
<td>85.1%</td>
<td>...</td>
<td>23</td>
<td>27.4%</td>
<td>48.9%</td>
<td>7</td>
<td>8.300000000000001%</td>
<td>14.9%</td>
<td>25</td>
<td>29.8%</td>
<td>5</td>
<td>6%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Total Cohort</td>
<td>01M515</td>
<td>LOWER EAST SIDE PREPARATORY HIGH SCHO</td>
<td>2006</td>
<td>193</td>
<td>105</td>
<td>54.4%</td>
<td>91</td>
<td>47.2%</td>
<td>86.7%</td>
<td>...</td>
<td>22</td>
<td>11.4%</td>
<td>21%</td>
<td>14</td>
<td>7.3%</td>
<td>13.3%</td>
<td>53</td>
<td>27.5%</td>
<td>35</td>
<td>18.100000000000001%</td>
</tr>
</tbody>
</table>

<p>5 rows × 23 columns</p>
</div>
</div>
</div>
<p>After the dataset was filtered for the second time, it was left with 405 rows.</p>
<p>Let’s check the maximum frequency of DBNs again.</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data.graduation[<span class="st">"DBN"</span>].value_counts().<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>1</code></pre>
</div>
</div>
<p>The DBNs are now unique to each row in the dataset.</p>
</section>
</section>
<section id="column-names" class="level2">
<h2 class="anchored" data-anchor-id="column-names">Column Names</h2>
<p>We’re almost at the point where we can combine the datasets. However, the final dataset would have many columns. It would be good to be able to know which dataset each column came from. Thus, we will use the following prefix system:</p>
<ul>
<li><code>A_</code>: The <code>ap_2010</code> dataset</li>
<li><code>C_</code>: The <code>class_size</code> dataset</li>
<li><code>D_</code>: The <code>demographics</code> dataset</li>
<li><code>G_</code>: The <code>graduation</code> dataset</li>
<li><code>H_</code>: The <code>hs_directory</code> dataset</li>
<li><code>R_</code>: The <code>sat_results</code> dataset</li>
<li><code>S_</code>: The <code>survey</code> dataset</li>
</ul>
<p>I add these prefixes using the code below.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df_name <span class="kw">in</span> data.index:</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Take the first letter, capitalize it, and append an underscore.</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_name <span class="op">==</span> <span class="st">"sat_results"</span>:</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>        prefix <span class="op">=</span> <span class="st">"R_"</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>        prefix <span class="op">=</span> df_name[<span class="dv">0</span>].upper() <span class="op">+</span> <span class="st">"_"</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add the prefix to each column label.</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> data[df_name]</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    non_dbn <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df <span class="cf">if</span> col <span class="op">!=</span> <span class="st">"DBN"</span>]</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    dbn_col <span class="op">=</span> df[[<span class="st">"DBN"</span>]]</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    other_cols <span class="op">=</span> df[non_dbn].add_prefix(prefix)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Put the df back into the data Series.</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    data[df_name] <span class="op">=</span> pd.concat(</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        [dbn_col, other_cols],</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, let’s see what <code>ap_2010</code> looks like now:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>data.ap_2010.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">A_SchoolName</th>
<th data-quarto-table-cell-role="th">A_AP Test Takers</th>
<th data-quarto-table-cell-role="th">A_Total Exams Taken</th>
<th data-quarto-table-cell-role="th">A_Number of Exams with scores 3 4 or 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD H.S.</td>
<td>39.0</td>
<td>49.0</td>
<td>10.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY HS</td>
<td>19.0</td>
<td>21.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M515</td>
<td>LOWER EASTSIDE PREP</td>
<td>24.0</td>
<td>26.0</td>
<td>24.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M539</td>
<td>NEW EXPLORATIONS SCI,TECH,MATH</td>
<td>255.0</td>
<td>377.0</td>
<td>191.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>02M296</td>
<td>High School of Hospitality Management</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The prefixes were added successfully.</p>
</section>
<section id="combining-datasets" class="level2">
<h2 class="anchored" data-anchor-id="combining-datasets">Combining Datasets</h2>
<p>At last, we are ready to combine all of the datasets into one. Datasets be merged on the <code>DBN</code> column since this is unique to each row.</p>
<p>We will start with the <code>sat_results</code> dataset as the first “left” dataset in the merging process.</p>
<p>We will consider <strong>two ways</strong> to merge datasets:</p>
<ul>
<li>Left join: Keep all rows in the “left” dataset, but remove rows in the “right” dataset if their DBNs had no match.</li>
<li>Inner join: Only keep rows where the DBN exists in both datasets.</li>
</ul>
<p>Before we choose, though, we will have to find out whether the DBNs in <code>sat_results</code> match the ones present in other datasets.</p>
<section id="heatmap-of-dbns" class="level3">
<h3 class="anchored" data-anchor-id="heatmap-of-dbns">Heatmap of DBNs</h3>
<p>In previous Dataquest guided projects, heatmaps were sometimes used to visualize correlation tables and missing values. I realized that this could be extended to the situation of the DBNs.</p>
<p>What if we created a DataFrame where:</p>
<ul>
<li>The columns represent the 7 datasets.</li>
<li>The indices represent the unique DBNs.</li>
<li>Each value is <code>True</code> if the DBN appears in the specific dataset, else <code>False</code>.</li>
</ul>
<p>Then, we would be able to create a heatmap to visualize which DBNs were present and absent in each dataset.</p>
<p>I wrote the code below in order to make the DataFrame.</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>col_list <span class="op">=</span> []</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df_name <span class="kw">in</span> data.index:</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    dbn <span class="op">=</span> data[df_name][[<span class="st">"DBN"</span>]] <span class="co"># Get a 1-column DataFrame of DBN values.</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    new_col <span class="op">=</span> dbn.set_index(<span class="st">"DBN"</span>) <span class="co"># Set the DBNs as the indices. There are no columns now.</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    new_col[df_name] <span class="op">=</span> <span class="dv">1</span> <span class="co"># Create a new column of ones.</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    col_list.append(new_col) <span class="co"># Append the column to the list.</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the columns into one DataFrame.</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>dbn_grid <span class="op">=</span> pd.concat(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    col_list,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>).notnull() <span class="co"># Replace values with False if they're null, else True.</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>dbn_grid.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ap_2010</th>
<th data-quarto-table-cell-role="th">class_size</th>
<th data-quarto-table-cell-role="th">demographics</th>
<th data-quarto-table-cell-role="th">graduation</th>
<th data-quarto-table-cell-role="th">hs_directory</th>
<th data-quarto-table-cell-role="th">sat_results</th>
<th data-quarto-table-cell-role="th">survey</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">01M448</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01M450</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01M515</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01M539</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">02M296</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s take the top left cell as an example. Its value is <code>True</code>. This means that the DBN 01M448 appears in the <code>ap_2010</code> dataset.</p>
<p>Since SAT performance is our focus, we can filter the rows in the DataFrame to only include the ones where the DBN is present in <code>sat_results</code>.</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dbn_grid <span class="op">=</span> dbn_grid.loc[</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    dbn_grid[<span class="st">"sat_results"</span>] <span class="co"># Keep rows where this column contains True values.</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can plot our heatmap. Above it, we will also print a table of the exact number of relevant DBNs present in each dataset.</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Counts of relevant DBNs in each dataset"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dbn_grid.<span class="bu">sum</span>())</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initiate the figure</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a heatmap of the boolean dataframe</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    dbn_grid,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> <span class="va">True</span>, <span class="co"># Include a color bar.</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    yticklabels <span class="op">=</span> <span class="va">False</span>, <span class="co"># Do not show y-tick labels.</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Heatmap of Relevant DBN Values in each Dataset"</span>)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Dataset"</span>)</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Counts of relevant DBNs in each dataset
ap_2010         251
class_size      401
demographics    412
graduation      381
hs_directory    339
sat_results     421
survey          418
dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-46-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Each column in the heatmap corresponds to one of our 7 datasets. The y-axis represents the unique DBNs.</p>
<p>The DBNs present in a dataset are represented by a light brown color. The missing DBNs are represented by black.</p>
<p>The following can be observed:</p>
<ul>
<li>The <code>sat_results</code> dataset is complete since we are using it as our basis for which DBNs are “relevant.” There are 421 relevant DBNs in total.</li>
<li>The <code>ap_2010</code> dataset has the least DBNs, only 251.</li>
<li><code>hs_directory</code> and <code>graduation</code> have missing DBNs scattered around. They have less than 400 DBNs each.</li>
<li><code>class_size</code>, <code>demographics</code>, and <code>survey</code> are the most complete datasets, with over 400 DBNs.</li>
</ul>
<p>This information will help us in choosing how to merge the datasets.</p>
</section>
<section id="left-join" class="level3">
<h3 class="anchored" data-anchor-id="left-join">Left join</h3>
<p>The advantage of performing a left join is apparent when the “right” dataset has <strong>many missing DBN values</strong>.</p>
<ul>
<li>With a left join, all of the <code>sat_results</code> rows would be kept.</li>
<li>With an inner join, the number of rows would be significantly reduced.</li>
</ul>
<p>We saw that <code>ap_2010</code>, <code>hs_directory</code>, and <code>graduation</code> have the most missing DBN values, so these are good candidates for a left join. These 3 datasets provide information that is supplementary but not very crucial to our analysis, so it is fine for some rows to contain missing values.</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> data.sat_results</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df_name <span class="kw">in</span> [<span class="st">"ap_2010"</span>, <span class="st">"hs_directory"</span>, <span class="st">"graduation"</span>]:</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge horizontally.</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> combined.merge(</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>        data[df_name],</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>        on <span class="op">=</span> <span class="st">"DBN"</span>, <span class="co"># Merge on DBN column</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>        how <span class="op">=</span> <span class="st">"left"</span>, <span class="co"># Left join</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined.shape)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>combined.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(421, 92)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">R_SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">R_Num of SAT Test Takers</th>
<th data-quarto-table-cell-role="th">R_SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Writing Avg. Score</th>
<th data-quarto-table-cell-role="th">R_sat_score</th>
<th data-quarto-table-cell-role="th">A_SchoolName</th>
<th data-quarto-table-cell-role="th">A_AP Test Takers</th>
<th data-quarto-table-cell-role="th">A_Total Exams Taken</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">G_Regents w/o Advanced - n</th>
<th data-quarto-table-cell-role="th">G_Regents w/o Advanced - % of cohort</th>
<th data-quarto-table-cell-role="th">G_Regents w/o Advanced - % of grads</th>
<th data-quarto-table-cell-role="th">G_Local - n</th>
<th data-quarto-table-cell-role="th">G_Local - % of cohort</th>
<th data-quarto-table-cell-role="th">G_Local - % of grads</th>
<th data-quarto-table-cell-role="th">G_Still Enrolled - n</th>
<th data-quarto-table-cell-role="th">G_Still Enrolled - % of cohort</th>
<th data-quarto-table-cell-role="th">G_Dropped Out - n</th>
<th data-quarto-table-cell-role="th">G_Dropped Out - % of cohort</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL STUDIES</td>
<td>29</td>
<td>355.0</td>
<td>404.0</td>
<td>363.0</td>
<td>1122.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>36</td>
<td>46.2%</td>
<td>83.7%</td>
<td>7</td>
<td>9%</td>
<td>16.3%</td>
<td>16</td>
<td>20.5%</td>
<td>11</td>
<td>14.1%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>91</td>
<td>383.0</td>
<td>423.0</td>
<td>366.0</td>
<td>1172.0</td>
<td>UNIVERSITY NEIGHBORHOOD H.S.</td>
<td>39.0</td>
<td>49.0</td>
<td>...</td>
<td>34</td>
<td>27.4%</td>
<td>64.2%</td>
<td>11</td>
<td>8.9%</td>
<td>20.8%</td>
<td>46</td>
<td>37.1%</td>
<td>20</td>
<td>16.100000000000001%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>70</td>
<td>377.0</td>
<td>402.0</td>
<td>370.0</td>
<td>1149.0</td>
<td>EAST SIDE COMMUNITY HS</td>
<td>19.0</td>
<td>21.0</td>
<td>...</td>
<td>67</td>
<td>74.400000000000006%</td>
<td>95.7%</td>
<td>3</td>
<td>3.3%</td>
<td>4.3%</td>
<td>15</td>
<td>16.7%</td>
<td>5</td>
<td>5.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M458</td>
<td>FORSYTH SATELLITE ACADEMY</td>
<td>7</td>
<td>414.0</td>
<td>401.0</td>
<td>359.0</td>
<td>1174.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>44</td>
<td>390.0</td>
<td>433.0</td>
<td>384.0</td>
<td>1207.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>23</td>
<td>27.4%</td>
<td>48.9%</td>
<td>7</td>
<td>8.300000000000001%</td>
<td>14.9%</td>
<td>25</td>
<td>29.8%</td>
<td>5</td>
<td>6%</td>
</tr>
</tbody>
</table>

<p>5 rows × 92 columns</p>
</div>
</div>
</div>
<p>The dataset still has all of the data from <code>sat_results</code> due to the left join. There are some missing values where the other datasets didn’t find a matching DBN.</p>
</section>
<section id="inner-join" class="level3">
<h3 class="anchored" data-anchor-id="inner-join">Inner join</h3>
<p>Inner joins are advantageous when the “right” dataset is <strong>important to analysis</strong>. We would want each row to have complete data from this dataset.</p>
<p>In our case, the remaining datasets to merge are <code>class_size</code>, <code>demographics</code>, and <code>survey</code>. We need the latter two datasets to be complete, since we aim to explore the relationships between student demographics and SAT performance. Thus, we will use an inner join.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> df_name <span class="kw">in</span> [<span class="st">"class_size"</span>, <span class="st">"demographics"</span>, <span class="st">"survey"</span>]:</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge horizontally.</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    combined <span class="op">=</span> combined.merge(</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>        data[df_name],</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        on <span class="op">=</span> <span class="st">"DBN"</span>, <span class="co"># Merge on DBN column</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>        how <span class="op">=</span> <span class="st">"inner"</span>, <span class="co"># Inner join</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(combined.shape)</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>combined.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(401, 158)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">R_SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">R_Num of SAT Test Takers</th>
<th data-quarto-table-cell-role="th">R_SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Writing Avg. Score</th>
<th data-quarto-table-cell-role="th">R_sat_score</th>
<th data-quarto-table-cell-role="th">A_SchoolName</th>
<th data-quarto-table-cell-role="th">A_AP Test Takers</th>
<th data-quarto-table-cell-role="th">A_Total Exams Taken</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">S_eng_t_11</th>
<th data-quarto-table-cell-role="th">S_aca_t_11</th>
<th data-quarto-table-cell-role="th">S_saf_s_11</th>
<th data-quarto-table-cell-role="th">S_com_s_11</th>
<th data-quarto-table-cell-role="th">S_eng_s_11</th>
<th data-quarto-table-cell-role="th">S_aca_s_11</th>
<th data-quarto-table-cell-role="th">S_saf_tot_11</th>
<th data-quarto-table-cell-role="th">S_com_tot_11</th>
<th data-quarto-table-cell-role="th">S_eng_tot_11</th>
<th data-quarto-table-cell-role="th">S_aca_tot_11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL STUDIES</td>
<td>29</td>
<td>355.0</td>
<td>404.0</td>
<td>363.0</td>
<td>1122.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>6.1</td>
<td>6.5</td>
<td>6.0</td>
<td>5.6</td>
<td>6.1</td>
<td>6.7</td>
<td>6.7</td>
<td>6.2</td>
<td>6.6</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>91</td>
<td>383.0</td>
<td>423.0</td>
<td>366.0</td>
<td>1172.0</td>
<td>UNIVERSITY NEIGHBORHOOD H.S.</td>
<td>39.0</td>
<td>49.0</td>
<td>...</td>
<td>6.6</td>
<td>7.3</td>
<td>6.0</td>
<td>5.7</td>
<td>6.3</td>
<td>7.0</td>
<td>6.8</td>
<td>6.3</td>
<td>6.7</td>
<td>7.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>70</td>
<td>377.0</td>
<td>402.0</td>
<td>370.0</td>
<td>1149.0</td>
<td>EAST SIDE COMMUNITY HS</td>
<td>19.0</td>
<td>21.0</td>
<td>...</td>
<td>8.0</td>
<td>8.8</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>7.9</td>
<td>7.9</td>
<td>8.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01M458</td>
<td>FORSYTH SATELLITE ACADEMY</td>
<td>7</td>
<td>414.0</td>
<td>401.0</td>
<td>359.0</td>
<td>1174.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>8.9</td>
<td>8.9</td>
<td>6.8</td>
<td>6.1</td>
<td>6.1</td>
<td>6.8</td>
<td>7.8</td>
<td>7.1</td>
<td>7.2</td>
<td>7.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>44</td>
<td>390.0</td>
<td>433.0</td>
<td>384.0</td>
<td>1207.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>6.1</td>
<td>6.8</td>
<td>6.4</td>
<td>5.9</td>
<td>6.4</td>
<td>7.0</td>
<td>6.9</td>
<td>6.2</td>
<td>6.6</td>
<td>7.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 158 columns</p>
</div>
</div>
</div>
<p>The final <code>combined</code> DataFrame has 401 rows (schools) and 158 columns. That’s only 20 rows less than what we started with.</p>
</section>
</section>
<section id="city-school-districts" class="level2">
<h2 class="anchored" data-anchor-id="city-school-districts">City School Districts</h2>
<p>Additionally, we will create a new column containing the city school district (CSD) of each school. The CSD is made up of the <strong>first 2 digits</strong> of a school’s DBN.</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the new column.</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>combined[<span class="st">"school_dist"</span>] <span class="op">=</span> combined[<span class="st">"DBN"</span>].<span class="bu">apply</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> text: text[:<span class="dv">2</span>] <span class="co"># Get first two characters.</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the columns.</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>combined <span class="op">=</span> reorder_columns(combined, [<span class="st">"school_dist"</span>])</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>combined.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">school_dist</th>
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th">R_SCHOOL NAME</th>
<th data-quarto-table-cell-role="th">R_Num of SAT Test Takers</th>
<th data-quarto-table-cell-role="th">R_SAT Critical Reading Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Math Avg. Score</th>
<th data-quarto-table-cell-role="th">R_SAT Writing Avg. Score</th>
<th data-quarto-table-cell-role="th">R_sat_score</th>
<th data-quarto-table-cell-role="th">A_SchoolName</th>
<th data-quarto-table-cell-role="th">A_AP Test Takers</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">S_eng_t_11</th>
<th data-quarto-table-cell-role="th">S_aca_t_11</th>
<th data-quarto-table-cell-role="th">S_saf_s_11</th>
<th data-quarto-table-cell-role="th">S_com_s_11</th>
<th data-quarto-table-cell-role="th">S_eng_s_11</th>
<th data-quarto-table-cell-role="th">S_aca_s_11</th>
<th data-quarto-table-cell-role="th">S_saf_tot_11</th>
<th data-quarto-table-cell-role="th">S_com_tot_11</th>
<th data-quarto-table-cell-role="th">S_eng_tot_11</th>
<th data-quarto-table-cell-role="th">S_aca_tot_11</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01</td>
<td>01M292</td>
<td>HENRY STREET SCHOOL FOR INTERNATIONAL STUDIES</td>
<td>29</td>
<td>355.0</td>
<td>404.0</td>
<td>363.0</td>
<td>1122.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>6.1</td>
<td>6.5</td>
<td>6.0</td>
<td>5.6</td>
<td>6.1</td>
<td>6.7</td>
<td>6.7</td>
<td>6.2</td>
<td>6.6</td>
<td>7.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01</td>
<td>01M448</td>
<td>UNIVERSITY NEIGHBORHOOD HIGH SCHOOL</td>
<td>91</td>
<td>383.0</td>
<td>423.0</td>
<td>366.0</td>
<td>1172.0</td>
<td>UNIVERSITY NEIGHBORHOOD H.S.</td>
<td>39.0</td>
<td>...</td>
<td>6.6</td>
<td>7.3</td>
<td>6.0</td>
<td>5.7</td>
<td>6.3</td>
<td>7.0</td>
<td>6.8</td>
<td>6.3</td>
<td>6.7</td>
<td>7.2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01</td>
<td>01M450</td>
<td>EAST SIDE COMMUNITY SCHOOL</td>
<td>70</td>
<td>377.0</td>
<td>402.0</td>
<td>370.0</td>
<td>1149.0</td>
<td>EAST SIDE COMMUNITY HS</td>
<td>19.0</td>
<td>...</td>
<td>8.0</td>
<td>8.8</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>7.9</td>
<td>7.9</td>
<td>7.9</td>
<td>8.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01</td>
<td>01M458</td>
<td>FORSYTH SATELLITE ACADEMY</td>
<td>7</td>
<td>414.0</td>
<td>401.0</td>
<td>359.0</td>
<td>1174.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>8.9</td>
<td>8.9</td>
<td>6.8</td>
<td>6.1</td>
<td>6.1</td>
<td>6.8</td>
<td>7.8</td>
<td>7.1</td>
<td>7.2</td>
<td>7.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01</td>
<td>01M509</td>
<td>MARTA VALLE HIGH SCHOOL</td>
<td>44</td>
<td>390.0</td>
<td>433.0</td>
<td>384.0</td>
<td>1207.0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>6.1</td>
<td>6.8</td>
<td>6.4</td>
<td>5.9</td>
<td>6.4</td>
<td>7.0</td>
<td>6.9</td>
<td>6.2</td>
<td>6.6</td>
<td>7.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 159 columns</p>
</div>
</div>
</div>
<p>The data is now cleaned and ready for analysis.</p>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<section id="correlation-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="correlation-coefficients">Correlation Coefficients</h2>
<p>The goal of this project is to determine how demographic factors affect SAT scores. Thus, we can start our analysis by investigating the Pearson’s correlation coefficient between SAT score and each of the other columns.</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>sat_corr <span class="op">=</span> (</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    combined</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    .corr()[<span class="st">"R_sat_score"</span>] <span class="co"># Take sat_score correlations</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    .drop([<span class="st">"R_sat_score"</span>]) <span class="co"># Drop unnecessary variables</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    .dropna() <span class="co"># Drop missing values</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The correlation table has one value for each of the numerical columns in <code>combined</code>.</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sat_corr.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>R_SAT Critical Reading Avg. Score    0.976819
R_SAT Math Avg. Score                0.956406
R_SAT Writing Avg. Score             0.981751
A_AP Test Takers                     0.625184
A_Total Exams Taken                  0.614112
Name: R_sat_score, dtype: float64</code></pre>
</div>
</div>
<p>We’ll analyze the data by going through each set of variables based on their original dataset. We’ll only use the most important datasets.</p>
<p>Before we do this, we’ll define a function that will take a Series and return values whose labels have certain prefixes. This will help us select parts of the correlation table more easily.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> filter_prefix(series, regex):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Takes a Series and a regex. Returns items in the Series whose labels match the regex at the start."""</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> series[[</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>        label <span class="cf">for</span> label <span class="kw">in</span> series.index</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.match(regex, label)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    ]]</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example, we could select all correlations for <code>ap_2010</code> and <code>class_size</code> variables by filtering prefixes <code>A</code> and <code>C</code>.</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>filter_prefix(sat_corr, <span class="vs">r"[AC]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>A_AP Test Takers                          0.625184
A_Total Exams Taken                       0.614112
A_Number of Exams with scores 3 4 or 5    0.614752
C_CSD                                     0.054011
C_NUMBER OF STUDENTS / SEATS FILLED       0.400095
C_NUMBER OF SECTIONS                      0.364537
C_AVERAGE CLASS SIZE                      0.395964
C_SIZE OF SMALLEST CLASS                  0.282388
C_SIZE OF LARGEST CLASS                   0.327099
Name: R_sat_score, dtype: float64</code></pre>
</div>
</div>
<p>Let’s proceed to the first set of variables.</p>
</section>
<section id="ap-exam-results" class="level2">
<h2 class="anchored" data-anchor-id="ap-exam-results">AP Exam Results</h2>
<p>First, we’ll look at the correlations for <code>ap_2010</code> variables.</p>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>filter_prefix(sat_corr, <span class="vs">r"[A]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>A_AP Test Takers                          0.625184
A_Total Exams Taken                       0.614112
A_Number of Exams with scores 3 4 or 5    0.614752
Name: R_sat_score, dtype: float64</code></pre>
</div>
</div>
<p>The number of AP test takers has a positive correlation of 0.63 with SAT score.</p>
<p>Remember that the AP exams are “Advanced Placement” exams taken by USA high schoolers in order to get college credit. Thus, the students who take AP exams tend to have higher academic performance.</p>
<p>Let’s make a scatter plot of SAT score against <strong>percentage of AP test takers in each school</strong>.</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a new column for AP test taker percentage.</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>combined[<span class="st">"A_ap_perc"</span>] <span class="op">=</span> combined[<span class="st">"A_AP Test Takers "</span>] <span class="op">/</span> combined[<span class="st">"D_total_enrollment"</span>]</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace inaccurate data (above 100%) with nulls.</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>combined[<span class="st">"A_ap_perc"</span>] <span class="op">=</span> combined[<span class="st">"A_ap_perc"</span>].mask(</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    combined[<span class="st">"A_ap_perc"</span>] <span class="op">&gt;</span> <span class="fl">1.0</span>,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    np.nan,</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"A_ap_perc"</span>,</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs AP Test Taker Percentage"</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"AP Test Taker Percentage"</span>)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-55-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The relationship is not linear. We can only observe that:</p>
<ul>
<li>Most schools have less than 40% AP takers and less than 1400 SAT points.</li>
<li>The schools with high SAT scores (above 1600) have less than 60% AP test takers.</li>
<li>The schools with low SAT scores (under 1400) can have any percentage of AP test takers.</li>
</ul>
<p>Therefore, it doesn’t seem that the percentage of AP test takers in a school reliably influences its average SAT score.</p>
</section>
<section id="survey-data" class="level2">
<h2 class="anchored" data-anchor-id="survey-data">Survey Data</h2>
<p>Let’s move on to the <code>survey</code> variables.</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>filter_prefix(sat_corr, <span class="vs">r"[S]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>S_rr_s          0.286470
S_rr_t          0.022365
S_rr_p          0.087970
S_N_s           0.438427
S_N_t           0.306520
S_N_p           0.439547
S_saf_p_11      0.111892
S_com_p_11     -0.106899
S_eng_p_11      0.016640
S_aca_p_11      0.026691
S_saf_t_11      0.315796
S_com_t_11      0.097797
S_eng_t_11      0.045746
S_aca_t_11      0.135490
S_saf_s_11      0.286153
S_com_s_11      0.157417
S_eng_s_11      0.174425
S_aca_s_11      0.292592
S_saf_tot_11    0.292468
S_com_tot_11    0.083068
S_eng_tot_11    0.093489
S_aca_tot_11    0.178388
Name: R_sat_score, dtype: float64</code></pre>
</div>
</div>
<p>The variable names are abbreviated, so it is difficult to understand them. However, the <a href="https://data.cityofnewyork.us/Education/2011-NYC-School-Survey/mnz3-dyi8">data dictionary</a> explains their meanings.</p>
<p>The most important ones are from <code>S_saf_p_11</code> downwards. These variables represent scores of 4 aspects of each school:</p>
<ul>
<li>Safety and Respect</li>
<li>Communication</li>
<li>Engagement</li>
<li>Academic Expectations</li>
</ul>
<p>Each aspect has 4 scores based on the respondent group: parents, teachers, students, and total (all groups).</p>
<p>For example, <code>S_saf_tot_11</code> refers to the total Safety and Respect score of a school. It had a coefficient of 0.29. Let’s see a scatterplot of this.</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"S_saf_tot_11"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs Safety and Respect Score (Total)"</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Safety and Respect Score (Total)"</span>)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The correlation is not strong, as many schools have SAT scores under 1400 regardless of Safety and Respect score.</p>
<p>The schools which did have high scores (above 1500) had safety scores ranging from 7.25 to 8.75. This suggests that having sufficient safety and respect in a school may support the learning experience, though it does not always increase SAT scores.</p>
<p>Another interesting variable would be <code>S_aca_s_11</code>, the Academic Expectations score based on student responses. It had a coefficient of 0.29.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"S_aca_s_11"</span>,</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs Academic Expectations Score (Students)"</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Academic Expectations Score (Students)"</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Again, the correlation is not strong.</p>
<p>It’s interesting to note, however, that none of the schools with an Academic Expectations score under 7.5 had SAT scores above 1600. We could say that a school must first have proper academic expectations in order to open the opportunity to excel.</p>
<p>In terms of strong conclusions, though, we can’t make any yet.</p>
</section>
<section id="demographics" class="level2">
<h2 class="anchored" data-anchor-id="demographics">Demographics</h2>
<p>Lastly, we go to the <code>demographics</code> dataset variables. These are the most important variables to investigate for this project.</p>
<p>Here are the correlation coefficients:</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>filter_prefix(sat_corr, <span class="vs">r"[D]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>D_frl_percent        -0.718163
D_total_enrollment    0.385741
D_ell_num            -0.130355
D_ell_percent        -0.379510
D_sped_num            0.058782
D_sped_percent       -0.420646
D_asian_num           0.483939
D_asian_per           0.552204
D_black_num           0.043408
D_black_per          -0.302794
D_hispanic_num        0.052672
D_hispanic_per       -0.363696
D_white_num           0.460505
D_white_per           0.646568
D_male_num            0.345808
D_male_per           -0.107624
D_female_num          0.403581
D_female_per          0.107676
Name: R_sat_score, dtype: float64</code></pre>
</div>
</div>
<p>The results can be divided into general topics:</p>
<ul>
<li><strong>School size</strong>: The <code>total_enrollment</code> has a coefficient of 0.39. This means that bigger schools may have higher SAT scores.</li>
<li><strong>English proficiency</strong>: The coefficient for ELL percentage is -0.38.
<ul>
<li>ELL means English Language Learner. It refers to students who are learning as a second or third language because they did not grow up with it.</li>
</ul></li>
<li><strong>SpEd percentage</strong>: The coefficient for SpEd percentage is -0.42.
<ul>
<li>SpEd means Special Education. It refers to educational plans with special accommodations for students who are disabled or have developmental disorders.</li>
</ul></li>
<li><strong>Sex</strong>: The following are the coefficients of the percentage of each sex:
<ul>
<li>Male: -0.11</li>
<li>Female: 0.11</li>
</ul></li>
<li><strong>Race</strong>: The following are the coefficients related to the percentage of students belonging to specific races.
<ul>
<li>Asian: 0.55</li>
<li>Black: -0.30</li>
<li>Hispanic: -0.36</li>
<li>White: 0.65</li>
</ul></li>
<li><strong>Socio-economic status</strong>: The coefficient for FRL percentage -0.72.
<ul>
<li>FRL means Free or Reduced-Price Lunch. This is a program that supports students below a certain income threshold who do not have the means to bring their own lunch to school.</li>
</ul></li>
</ul>
<p>We will go through each topic one by one.</p>
<section id="school-size" class="level3">
<h3 class="anchored" data-anchor-id="school-size">School Size</h3>
<p>Below, we plot a scatter plot of SAT scores against the total number of enrollees in each school.</p>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_total_enrollment"</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs Total Enrollment"</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Total Enrollment"</span>)</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-60-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The scatter plot doesn’t have a clear linear trend. Instead, the majority of points are clustered in one area, and the rest of the points are scattered.</p>
<p>Let’s inspect the names of the schools at the very bottom left, which have SAT scores under 1000 and total enrollment under 1000.</p>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>combined.loc[</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    (combined[<span class="st">"R_sat_score"</span>] <span class="op">&lt;</span> <span class="dv">1000</span>) <span class="op">&amp;</span> (combined[<span class="st">"D_total_enrollment"</span>] <span class="op">&lt;</span> <span class="dv">1000</span>),</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"R_SCHOOL NAME"</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>102                 INTERNATIONAL COMMUNITY HIGH SCHOOL
138                 ACADEMY FOR LANGUAGE AND TECHNOLOGY
139                     BRONX INTERNATIONAL HIGH SCHOOL
153               KINGSBRIDGE INTERNATIONAL HIGH SCHOOL
155               INTERNATIONAL SCHOOL FOR LIBERAL ARTS
197    PAN AMERICAN INTERNATIONAL HIGH SCHOOL AT MONROE
199                       HIGH SCHOOL OF WORLD CULTURES
210                  BROOKLYN INTERNATIONAL HIGH SCHOOL
241                                 PACIFIC HIGH SCHOOL
251       INTERNATIONAL HIGH SCHOOL AT PROSPECT HEIGHTS
266                          IT TAKES A VILLAGE ACADEMY
285                           MULTICULTURAL HIGH SCHOOL
314                ASPIRATIONS DIPLOMA PLUS HIGH SCHOOL
320              PAN AMERICAN INTERNATIONAL HIGH SCHOOL
Name: R_SCHOOL NAME, dtype: object</code></pre>
</div>
</div>
<p>Interestingly, the schools with the lowest average SAT scores are mostly small international schools. These schools tend to have more students from different racial and ethnic backgrounds. These students may speak English as a second or third language.</p>
<p>Therefore, the factor that affected SAT performance may have been the percentage of English language learners (ELL) in each school. This makes sense since the SAT is offered only in English and includes sections on Reading and Writing.</p>
</section>
<section id="english-proficiency" class="level3">
<h3 class="anchored" data-anchor-id="english-proficiency">English Proficiency</h3>
<p>Let’s plot SAT scores against the percentage of ELLs (English Language Learners) in each school.</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_ell_percent"</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs ELL Percentage"</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"ELL Percentage"</span>)</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-62-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Once again, there isn’t a linear trend even though the correlation coefficient between the variables was -0.38. However, we can note that:</p>
<ul>
<li>Most schools have less than 50% ELLs and less than 1400 SAT points.</li>
<li>The schools with the highest SAT scores (over 1500) have almost 0% ELLs.</li>
<li>All of the schools with over 50% ELLs have very low scores (under 1300).</li>
</ul>
<p>Therefore, it appears that ELL students are more challenged in reaching high SAT scores.</p>
</section>
<section id="sped-percentage" class="level3">
<h3 class="anchored" data-anchor-id="sped-percentage">SpEd Percentage</h3>
<p>The coefficient for SpEd percentage was -0.42, which indicates that schools with more SpEd students may have lower SAT scores. Let’s view a scatter plot:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_sped_percent"</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs SpEd Percentage"</span>)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"SpEd Percentage"</span>)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The correlation is somewhat linear, but it is not very steep. The points are very scattered, especially on the left side. Interestingly, the schools with an SAT score over 1600 had 15% or less SpEd students.</p>
<p>However, the variable doesn’t predict SAT score well.</p>
</section>
<section id="sex" class="level3">
<h3 class="anchored" data-anchor-id="sex">Sex</h3>
<p>Another factor that’s important to investigate is sex. Do schools with more male students or more female students have higher SAT scores?</p>
<p>Earlier, we saw that the male and female percentages had weak correlations with SAT score.</p>
<ul>
<li>Male: -0.11; lower SAT scores.</li>
<li>Female: 0.11; higher SAT scores.</li>
</ul>
<p>However, these correlations are <em>weak</em>, so the difference may not be that great.</p>
<p>Let’s use the <code>female_per</code> variable in a scatter plot.</p>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_female_per"</span>,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs Female Percentage"</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Female Percentage"</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As expected, the correlation is weak. We can see that:</p>
<ul>
<li>In most schools, 40% to 60% of students are female.</li>
<li>SAT score is typically below 1400 regardless of female percentage.</li>
<li>The schools with the highest SAT scores (above 1500) have a 30% to 75% female population.</li>
</ul>
<p>This variable doesn’t seem to be very important to SAT score.</p>
</section>
<section id="race" class="level3">
<h3 class="anchored" data-anchor-id="race">Race</h3>
<p>Earlier, we saw that the following were the coefficients for race percentage variables. Positive values imply that a higher percentage of the given race may lead to higher average SAT score. Negative values: lower score.</p>
<ul>
<li>Asian: 0.55</li>
<li>Black: -0.30</li>
<li>Hispanic: -0.36</li>
<li>White: 0.65</li>
</ul>
<p>Out of all 4, the white percentage value has the strongest correlation, 0.65. This means that having more white students in a school can lead to a higher average SAT score. Let’s see a scatterplot of this.</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_white_per"</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs White Percentage"</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"White Percentage"</span>)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-65-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Though the correlation coefficient was stronger than the others, the trend is loose; the points are scattered far away from each other. We can see that:</p>
<ul>
<li>Most of the schools in the dataset have SAT scores under 1400 and white percentage under 20%.</li>
<li>The schools with the highest scores have white percentages ranging from under 10% to over 60%.</li>
</ul>
<p>Thus, we can’t say that a higher white percentage definitely raises the average SAT score.</p>
<p>Since the other race-related variables are weaker than this one, we won’t investigate them further. Let’s move on to the topic of socio-economic status.</p>
</section>
<section id="socio-economic-status" class="level3">
<h3 class="anchored" data-anchor-id="socio-economic-status">Socio-economic status</h3>
<p>As mentioned earlier, there was a variable representing the percentage of students availing of FRL (Free or Reduced-Price Lunch). Since FRL is for students below an income threshold, we can consider it similar to a <strong>poverty rate</strong>.</p>
<p>The correlation coefficient for this variable is the strongest at -0.72. The FRL students may have lower SAT scores due to external difficulties associated with low socio-economic status which hinder their education.</p>
<p>Below is the scatterplot.</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>combined.plot.scatter(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">"D_frl_percent"</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"SAT Score vs FRL Percentage"</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"FRL Percentage"</span>)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Average SAT Score"</span>)</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This graph shows a tighter, more linear relationship than was seen in the other graphs.</p>
<p>At the top left of the graph are schools with low FRL percentage and high average SAT score. There are still a few schools with an SAT score over 1600 despite an FRL percentage of over 50%.</p>
<p>However, for the majority of the schools, the FRL percentage is over 60%. All of these schools have an SAT score less than 1500.</p>
<p>Generally, the results suggest that <strong>socio-economic status</strong> is the strongest predictor of average SAT score among all variables in the dataset. <strong>High poverty rate</strong> is associated with a lower average SAT score.</p>
</section>
</section>
</section>
<section id="inferential-statistics-linear-regression" class="level1">
<h1>Inferential Statistics: Linear Regression</h1>
<p>As an additional step to this project, we will be performing Ordinary Least Squares linear regression. Some predictors may have a low Pearson’s correlation coefficient with the response variable but turn out to be statistically significant when other variables are taken into account.</p>
<p>I used <a href="https://pythonfordatascienceorg.wordpress.com/linear-regression-python/">Linear Regression</a> by Python for Data Science LLC, along with <a href="https://towardsdatascience.com/simple-linear-regression-and-ols-introduction-to-the-theory-1b48f7c69867">(Simple) Linear Regression and OLS: Introduction to the Theory</a> (Sluijmers 2020), as my main references.</p>
<p>The dataset has 401 observations. The dependent variable (or response variable) will be each school’s average SAT total score, represented by <code>R_sat_score</code>.</p>
<p>As for independent variables (or predictor variables), we will start by considering the following.</p>
<ul>
<li>English proficiency
<ul>
<li><code>D_ell_percent</code></li>
</ul></li>
<li>SpEd percentage
<ul>
<li><code>D_sped_percent</code></li>
</ul></li>
<li>Sex
<ul>
<li><code>D_female_per</code></li>
<li><code>D_male_per</code></li>
</ul></li>
<li>Race
<ul>
<li><code>D_asian_per</code></li>
<li><code>D_black_per</code></li>
<li><code>D_hispanic_per</code></li>
<li><code>D_white_per</code></li>
</ul></li>
<li>Socio-economic status
<ul>
<li><code>D_frl_percent</code>.</li>
</ul></li>
</ul>
<p>The variable names are placed in the list below.</p>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>iv_list <span class="op">=</span> [</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_ell_percent"</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_sped_percent"</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_female_per"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_male_per"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_asian_per"</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_black_per"</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_hispanic_per"</span>,</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_white_per"</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_frl_percent"</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’d like to note that none of these columns have null values, so we don’t have to drop any rows or perform imputation.</p>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Null values in each column"</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>combined[iv_list].isnull().<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Null values in each column</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>D_ell_percent     0
D_sped_percent    0
D_female_per      0
D_male_per        0
D_asian_per       0
D_black_per       0
D_hispanic_per    0
D_white_per       0
D_frl_percent     0
dtype: int64</code></pre>
</div>
</div>
<p>Moving on, the code below creates a matrix <code>X</code> for IVs and vector <code>y</code> for the DV.</p>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>regression_data <span class="op">=</span> (</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    combined[[<span class="st">"DBN"</span>, <span class="st">"R_sat_score"</span>] <span class="op">+</span> iv_list]</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"DBN"</span>)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> regression_data[iv_list].copy()</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> regression_data[<span class="st">"R_sat_score"</span>].copy()</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>regression_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">R_sat_score</th>
<th data-quarto-table-cell-role="th">D_ell_percent</th>
<th data-quarto-table-cell-role="th">D_sped_percent</th>
<th data-quarto-table-cell-role="th">D_female_per</th>
<th data-quarto-table-cell-role="th">D_male_per</th>
<th data-quarto-table-cell-role="th">D_asian_per</th>
<th data-quarto-table-cell-role="th">D_black_per</th>
<th data-quarto-table-cell-role="th">D_hispanic_per</th>
<th data-quarto-table-cell-role="th">D_white_per</th>
<th data-quarto-table-cell-role="th">D_frl_percent</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">DBN</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">01M292</td>
<td>1122.0</td>
<td>22.3</td>
<td>24.9</td>
<td>38.6</td>
<td>61.4</td>
<td>14.0</td>
<td>29.1</td>
<td>53.8</td>
<td>1.7</td>
<td>88.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01M448</td>
<td>1172.0</td>
<td>21.1</td>
<td>21.8</td>
<td>42.6</td>
<td>57.4</td>
<td>29.2</td>
<td>22.6</td>
<td>45.9</td>
<td>2.3</td>
<td>71.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01M450</td>
<td>1149.0</td>
<td>5.0</td>
<td>26.4</td>
<td>45.3</td>
<td>54.7</td>
<td>9.7</td>
<td>23.9</td>
<td>55.4</td>
<td>10.4</td>
<td>71.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">01M458</td>
<td>1174.0</td>
<td>4.0</td>
<td>8.9</td>
<td>56.7</td>
<td>43.3</td>
<td>2.2</td>
<td>34.4</td>
<td>59.4</td>
<td>3.6</td>
<td>72.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">01M509</td>
<td>1207.0</td>
<td>11.2</td>
<td>25.9</td>
<td>53.7</td>
<td>46.3</td>
<td>9.3</td>
<td>31.6</td>
<td>56.9</td>
<td>1.6</td>
<td>80.7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32K549</td>
<td>1035.0</td>
<td>18.2</td>
<td>18.4</td>
<td>51.6</td>
<td>48.4</td>
<td>0.5</td>
<td>28.3</td>
<td>68.7</td>
<td>1.8</td>
<td>75.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32K552</td>
<td>1060.0</td>
<td>23.9</td>
<td>22.1</td>
<td>45.5</td>
<td>54.5</td>
<td>1.5</td>
<td>26.4</td>
<td>70.4</td>
<td>1.0</td>
<td>77.1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32K554</td>
<td>1315.0</td>
<td>2.7</td>
<td>4.9</td>
<td>47.9</td>
<td>52.1</td>
<td>5.3</td>
<td>12.9</td>
<td>79.5</td>
<td>1.5</td>
<td>81.4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32K556</td>
<td>1055.0</td>
<td>18.2</td>
<td>18.6</td>
<td>46.8</td>
<td>53.2</td>
<td>0.9</td>
<td>21.2</td>
<td>77.3</td>
<td>0.0</td>
<td>88.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32K564</td>
<td>1034.0</td>
<td>5.2</td>
<td>9.4</td>
<td>55.8</td>
<td>44.2</td>
<td>0.3</td>
<td>35.9</td>
<td>61.5</td>
<td>1.8</td>
<td>81.8</td>
</tr>
</tbody>
</table>

<p>401 rows × 10 columns</p>
</div>
</div>
</div>
<p>Before we fit and interpret the model with these DataFrames, we must first test the assumptions of linear regression.</p>
<section id="multicollinearity" class="level2">
<h2 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h2>
<p><a href="https://statisticsbyjim.com/regression/multicollinearity-in-regression-analysis/">Multicollinearity</a> occurs when multiple predictor variables are highly correlated. Variables with high multicollinearity have unreliable significance values. Thus, this is a problem that must be avoided.</p>
<p>The first way to check for multicollinearity is with a <strong>Pearson’s correlation coefficient table</strong>. The code below plots this table using a heatmap for easier interpretation.</p>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a correlation matrix from X.</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> X.corr()</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mask that selects the bottom left triangle of the table.</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> corr.iloc[<span class="dv">1</span>:, :<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(         <span class="co"># Replace the lower triangle with 0's.</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    np.ones_like(corr), <span class="co"># Make a DataFrame of 1's with the same shape as corr.</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">1</span>,              <span class="co"># Raise the diagonal by 1.</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a heatmap of the values.</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    corr,</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>    vmin <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, <span class="co"># Anchor colors on -1 and 1.</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>    vmax <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> <span class="va">True</span>, <span class="co"># Draw a color bar.</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">"RdBu"</span>, <span class="co"># Use Red for negatives and Blue for positives.</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> mask, <span class="co"># Use a mask to remove the upper right triangle of the matrix.</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>    annot <span class="op">=</span> <span class="va">True</span>, <span class="co"># Write the data value in each cell.</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the text in the plot to make it easier to read.</span></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> text <span class="kw">in</span> ax.texts:</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>    coeff <span class="op">=</span> <span class="bu">float</span>(text.get_text())</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove data values with low correlation.</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">abs</span>(coeff) <span class="op">&lt;</span> <span class="fl">0.3</span>: </span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>        text.set_text(<span class="st">''</span>)</span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Round all visible data values to the hundredths place.</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>        text.set_text(<span class="bu">round</span>(coeff, <span class="dv">2</span>))</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>    text.set_fontsize(<span class="st">"large"</span>)</span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Heatmap of Independent Variables"</span>)</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Rotate x-ticks to read from top to bottom.</span></span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation <span class="op">=</span> <span class="op">-</span><span class="dv">30</span>, ha <span class="op">=</span> <span class="st">"left"</span>, size <span class="op">=</span> <span class="st">"large"</span>) </span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>plt.yticks(rotation <span class="op">=</span> <span class="dv">0</span>, size <span class="op">=</span> <span class="st">"large"</span>)</span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-70-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In the heatmap above, blue colors represent positive correlation; red represents negative correlation. Colors with more saturation indicate that the correlation is stronger.</p>
<p>I removed most of the coefficient labels except for the ones greater than 0.3, which show somewhat strong correlations. Interestingly, we can see that:</p>
<ul>
<li>Male percentage has a perfect negative correlation with female percentage. This is to be expected since both must sum up to 100.</li>
<li>Hispanic percentage is correlated with black percentage and FRL percentage.</li>
<li>White percentage is strongly negatively correlated with FRL percentage, indicating that schools with more white students also have fewer poor students.</li>
</ul>
<p>Another way to assess multicollinearity is to use <strong>variance inflation factors</strong> or VIFs. These are numbers greater than or equal to 1.</p>
<p>A VIF less than 5 suggests low to moderate collinearity. If a predictor’s VIF is at least 5, this indicates high multicollinearity, so the significance value is not reliable.</p>
<p>The code below produces a VIF for each predictor.</p>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> variance_inflation_factor <span class="im">as</span> sm_vif</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_vif(X):</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get a VIF value for each column in a DataFrame."""</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>    vif_df <span class="op">=</span> pd.DataFrame() </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>    vif_df[<span class="st">"label"</span>] <span class="op">=</span> X.columns</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>    vif_df[<span class="st">"VIF"</span>] <span class="op">=</span> [</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        sm_vif(X.values, i)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(X.columns))</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>    vif_df.set_index(<span class="st">"label"</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> vif_df</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>get_vif(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_ell_percent</td>
<td>2.874752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_sped_percent</td>
<td>8.509117</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_female_per</td>
<td>2578.305578</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_male_per</td>
<td>2569.217298</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_asian_per</td>
<td>304.520086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_black_per</td>
<td>2196.055978</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_hispanic_per</td>
<td>2413.721821</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_white_per</td>
<td>231.186584</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_frl_percent</td>
<td>60.692762</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>These values are problematic. Almost all of the VIFs indicate strong multicollinearity except for that of <code>D_ell_percent</code>. This is likely due to the strong correlations we saw earlier in the heatmap.</p>
<p>Therefore, we must remove a few variables with high multicollinearity.</p>
<ul>
<li>I choose to remove <code>male_per</code> since it has -1.0 correlation with <code>female_per</code>, which makes it redundant.</li>
<li>I choose to remove <code>hispanic_per</code> because it has over 0.5 correlation with <code>black_per</code> and <code>frl_percent</code>.</li>
<li>I choose to remove <code>frl_percent</code> since it has over 0.3 correlation with 4 other variables, including 0.7 correlation with <code>white_per</code>.</li>
</ul>
<p>Thus, below is the new list of predictors.</p>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>iv_list <span class="op">=</span> [</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_ell_percent"</span>,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_sped_percent"</span>,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_female_per"</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_asian_per"</span>,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_black_per"</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"D_white_per"</span>,</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>regression_data <span class="op">=</span> (</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    combined[[<span class="st">"DBN"</span>, <span class="st">"R_sat_score"</span>] <span class="op">+</span> iv_list]</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>    .set_index(<span class="st">"DBN"</span>)</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> regression_data[iv_list].copy()</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> regression_data[<span class="st">"R_sat_score"</span>].copy()</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>vif_df <span class="op">=</span> get_vif(X)</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>vif_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_ell_percent</td>
<td>1.600755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_sped_percent</td>
<td>3.824473</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_female_per</td>
<td>7.289758</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_asian_per</td>
<td>1.788134</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_black_per</td>
<td>3.926733</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_white_per</td>
<td>1.777499</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can see that most of the VIFs are less than 5, so the p-values in the model will be reliable. Only the <code>female_per</code> variable’s p-value will be unreliable. However, I will still include this in the model since the percentages of sexes in a school may have an effect on SAT performance.</p>
</section>
<section id="iid-errors-and-normality-of-residuals" class="level2">
<h2 class="anchored" data-anchor-id="iid-errors-and-normality-of-residuals">IID Errors and Normality of Residuals</h2>
<p>Next, we will be testing two more assumptions:</p>
<ul>
<li>IID (identically and independently distributed) residuals
<ul>
<li>This is tested using the <a href="https://www.statisticshowto.com/durbin-watson-test-coefficient/">Durbin-Watson</a> test statistic, which ranges from 0 to 4.</li>
<li>Ideally, the statistic should be <strong>close to 2</strong>.</li>
<li>As a rule of thumb, values from 1.5 to 2.5 are considered acceptable.</li>
</ul></li>
<li>Normality of residuals
<ul>
<li>This is tested using the Jarque-Bera test.</li>
<li>The null hypothesis is that the residuals are normally distributed.</li>
<li>A statistically significant value <strong>(p &lt; 0.05)</strong> supports the claim that the residuals are <strong>not normal</strong>.</li>
</ul></li>
</ul>
<p>In order to test these, we must fit the model and look at its results. <code>statsmodels</code> automatically calculates both the Durbin-Watson and the Jarque-Bera tests for us.</p>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS model</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the X matrix.</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This is done so that the y-intercept is not locked at 0.</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Make and fit the OLS model.</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> results.summary()</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract summary tables from OLS results summary.</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_summary(sm_summary):</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Take a statsmodels summary instance and return a list of DataFrames."""</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>    tables <span class="op">=</span> []</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>    t_inds <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">3</span>))</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> t_inds:</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>        table_as_html <span class="op">=</span> sm_summary.tables[i].as_html()</span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>        table_df <span class="op">=</span> pd.read_html(</span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>            table_as_html,</span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>            header <span class="op">=</span> (<span class="dv">0</span> <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="va">None</span>), <span class="co"># Only set a header for table 2.</span></span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>            index_col <span class="op">=</span> <span class="dv">0</span>,</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>        )[<span class="dv">0</span>]</span>
<span id="cb109-28"><a href="#cb109-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-29"><a href="#cb109-29" aria-hidden="true" tabindex="-1"></a>        tables.append(table_df)</span>
<span id="cb109-30"><a href="#cb109-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-31"><a href="#cb109-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb109-32"><a href="#cb109-32" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Combine summary table 1 with the VIF column.</span></span>
<span id="cb109-33"><a href="#cb109-33" aria-hidden="true" tabindex="-1"></a>            table_df <span class="op">=</span> pd.concat([table_df, vif_df], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb109-34"><a href="#cb109-34" aria-hidden="true" tabindex="-1"></a>            table_df.rename_axis(<span class="st">"label"</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb109-35"><a href="#cb109-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-36"><a href="#cb109-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb109-37"><a href="#cb109-37" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For tables 0 and 2, turn the index back into a column.</span></span>
<span id="cb109-38"><a href="#cb109-38" aria-hidden="true" tabindex="-1"></a>            table_df <span class="op">=</span> tables[i].reset_index()</span>
<span id="cb109-39"><a href="#cb109-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-40"><a href="#cb109-40" aria-hidden="true" tabindex="-1"></a>        tables[i] <span class="op">=</span> table_df</span>
<span id="cb109-41"><a href="#cb109-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-42"><a href="#cb109-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> tables</span>
<span id="cb109-43"><a href="#cb109-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-44"><a href="#cb109-44" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> extract_summary(summary)</span>
<span id="cb109-45"><a href="#cb109-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-46"><a href="#cb109-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the third table.</span></span>
<span id="cb109-47"><a href="#cb109-47" aria-hidden="true" tabindex="-1"></a>tables[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\migs\anaconda3\envs\new_streamlit_env2\lib\site-packages\statsmodels\tsa\tsatools.py:142: FutureWarning: In a future version of pandas all arguments of concat except for the argument 'objs' will be keyword-only
  x = pd.concat(x[::order], 1)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="72">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Omnibus:</td>
<td>28.251</td>
<td>Durbin-Watson:</td>
<td>1.660000e+00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Prob(Omnibus):</td>
<td>0.000</td>
<td>Jarque-Bera (JB):</td>
<td>6.075100e+01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Skew:</td>
<td>0.378</td>
<td>Prob(JB):</td>
<td>6.430000e-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Kurtosis:</td>
<td>4.751</td>
<td>Cond. No.</td>
<td>5.040000e+02</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The Durbin-Watson test statistic is 1.66. This is less than 2, so it indicates <strong>positive autocorrelation</strong> among residuals. (That is, each residual has a positive correlation with the residual before it). However, it falls within the acceptable range (1.5 to 2.5), so it is not a cause for concern.</p>
<p>The Jarque-Bera test significance, on the other hand, is <span class="math inline">\(6.43 \cdot 10^{-14}\)</span>, which is very close to 0. It is statistically significant, so the residuals are <strong>not normally distributed</strong>. However, since the sample size (401) is greater than 30, OLS regression is robust against deviations from normality. Thus, this is not a cause for concern either.</p>
<p>Let’s plot a <strong>histogram of residuals</strong> to inspect the deviation from normality, just to be sure.</p>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#%% Make a histogram of residuals.</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> results.resid</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">#bin_edges = get_bin_edges(residuals)</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>plt.hist(residuals, )<span class="co">#bins = bin_edges)</span></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Histogram of Residuals"</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Residual Error"</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Frequency"</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-74-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Though this isn’t normal, it is still somewhat bell-shaped. Most of the data converges around a residual error of 0, with fewer values going farther away. Thus, the distribution isn’t problematic.</p>
<p>We can also visualize normality of residuals using a Q-Q (quantile-quantile) plot.</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot a Q-Q plot.</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>sm.qqplot(</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> residuals,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    line <span class="op">=</span> <span class="st">"r"</span>,</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Regression line</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Q-Q Plot of Residuals"</span>)</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>plt.legend(</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> [<span class="st">"Actual data"</span>, <span class="st">"Theoretical quantiles line"</span>],</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    loc <span class="op">=</span> <span class="st">"best"</span>,</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\migs\anaconda3\envs\new_streamlit_env2\lib\site-packages\statsmodels\graphics\gofplots.py:993: UserWarning: marker is redundantly defined by the 'marker' keyword argument and the fmt string "bo" (-&gt; marker='o'). The keyword argument will take precedence.
  ax.plot(x, y, fmt, **plot_style)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-75-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The red line is our reference for normality. The blue dots should ideally follow this line. We can see that they do, though not perfectly, and the data are less normal at the higher quantiles. Generally, though, the data is close enough to being normal.</p>
<p>Lastly, for IID residuals, we can plot the residuals against the fitted response variable.</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals against fitted DV values.</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> results.fittedvalues</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> results.resid</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal line on the x axis.</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>plt.axhline(color <span class="op">=</span> <span class="st">"r"</span>, label <span class="op">=</span> <span class="st">"Fitted SAT Score"</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot.</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>plt.scatter(fitted, residuals, label <span class="op">=</span> <span class="st">"Residual Error"</span>)</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residuals against Fitted SAT Score"</span>)</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted SAT Score"</span>)</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residual Error"</span>)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>plt.legend(loc <span class="op">=</span> <span class="st">"best"</span>)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-76-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In this graph, we ideally want to see the points cluster uniformly around the red line, without any trends.</p>
<p>However, if we follow the outline of the general mass of points, these seem to follow a curve. However, the points on the right side are loosely scattered, so we cannot be sure whether there is truly a curve or it is merely due to outliers.</p>
<p>Anyway, we saw earlier that the Durbin-Watson test statistic was within the acceptable range, so the distribution of residuals is alright. We can move on to the next step.</p>
</section>
<section id="linearity" class="level2">
<h2 class="anchored" data-anchor-id="linearity">Linearity</h2>
<p>The next assumption that we will test is linearity. The predictors must be linearly correlated with the response variable; the relationship should not be too curved or abnormal.</p>
<p>We can test this visually by plotting the actual average SAT scores against the fitted scores which were predicted by our model.</p>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot actual SAT scores against fitted SAT scores.</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> results.fittedvalues</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>plt.scatter(fitted, y, label <span class="op">=</span> <span class="st">"Actual data"</span>)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Use OLS model results to get trend line.</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>x_fitting <span class="op">=</span> sm.add_constant(fitted)</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>trend_model <span class="op">=</span> sm.OLS(y, x_fitting)</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>trend_results <span class="op">=</span> trend_model.fit()</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>trend_params <span class="op">=</span> trend_results.params</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>trend_const <span class="op">=</span> trend_params[<span class="st">"const"</span>]</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>trend_coeff <span class="op">=</span> trend_params[<span class="dv">0</span>]</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>y_plot <span class="op">=</span> trend_coeff <span class="op">*</span> fitted <span class="op">+</span> trend_const</span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>plt.plot(fitted, y_plot, color <span class="op">=</span> <span class="st">"r"</span>, label <span class="op">=</span> <span class="st">"Trend line"</span>)</span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Extra plot info</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"""Actual SAT scores against Fitted SAT scores"""</span>)</span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Fitted SAT Score"</span>)</span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Actual SAT Score"</span>)</span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>plt.legend(loc <span class="op">=</span> <span class="st">"best"</span>)</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-30"><a href="#cb115-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\migs\anaconda3\envs\new_streamlit_env2\lib\site-packages\statsmodels\tsa\tsatools.py:142: FutureWarning: In a future version of pandas all arguments of concat except for the argument 'objs' will be keyword-only
  x = pd.concat(x[::order], 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-77-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>The trend line above fits the actual data quite well. Moreover, the actual data seems to follow a mostly linear shape. Thus, there is no cause for concern here.</p>
</section>
<section id="homoscedasticity" class="level2">
<h2 class="anchored" data-anchor-id="homoscedasticity">Homoscedasticity</h2>
<p>The last assumption that we will test is homoscedasticity. This means that the <strong>variance</strong> is consistent across all values of residuals. If this is not the case, the model has heteroscedasticity, which is problematic.</p>
<p>This can be tested using the Breusch-Pagan test. The null hypothesis is that heteroscedasticity is not present (which is ideal). A statistically significant p-value supports the claim that there is heteroscedasticity, in which case we would have to adjust the model.</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Breusch-Pagan test.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>b_labels <span class="op">=</span> [<span class="st">'Lagrange multiplier statistic'</span>, <span class="st">'p-value'</span>, <span class="st">'f-value'</span>, <span class="st">'f p-value'</span>]</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>b_test <span class="op">=</span> sms.het_breuschpagan(</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    residuals,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    model.exog,</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>b_results <span class="op">=</span> pd.DataFrame(<span class="bu">zip</span>(b_labels, b_test))</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>b_results.columns <span class="op">=</span> [<span class="st">"Information"</span>, <span class="st">"Value"</span>]</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>b_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Information</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Lagrange multiplier statistic</td>
<td>1.028960e+02</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>p-value</td>
<td>6.237518e-20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>f-value</td>
<td>2.266603e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>f p-value</td>
<td>5.711239e-23</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Both p-values have a factor of around <span class="math inline">\(10^{-20}\)</span>. In other words, these are very close to 0, which means that these are significant. Thus, the model is <strong>heteroscedastic</strong>.</p>
<p>We can make the results robust against heteroscedasticity by specifying an HCCM (Heteroscedasticity Consistent Covariance Matrix). We will specifically choose HC0. It doesn’t perform well for sample sizes under 250 (<a href="https://pythonfordatascienceorg.wordpress.com/linear-regression-python/">Python for Data Science</a>), but our sample size is 401, so we can use it.</p>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make and fit the OLS model.</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit(</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    cov_type <span class="op">=</span> <span class="st">'HC0'</span>, <span class="co"># Specify an HCCM.</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> results.summary()</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>tables <span class="op">=</span> extract_summary(summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we’ve tested all of the assumptions and adjusted for heteroscedasticity, we can move on to partial regression plots.</p>
</section>
<section id="partial-regression-plots" class="level2">
<h2 class="anchored" data-anchor-id="partial-regression-plots">Partial regression plots</h2>
<p><a href="https://www.statsmodels.org/devel/examples/notebooks/generated/regression_plots.html#Partial-Regression-Plots-(Duncan)">Partial regression plots</a> are used to visualize the relationship between 1 predictor and the response variable while <strong>holding all other predictors constant</strong>.</p>
<p>The plots are made below.</p>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">#%% Partial regression plots.</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> par_reg_plot(data, label, show_dbn <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Take a predictor label and plot its partial regression plot, which takes the other predictors into account.</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Note: This function references objects from the global namespace."""</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">"Partial Regression Plot</span><span class="ch">\n</span><span class="st">SAT Score against `</span><span class="sc">{}</span><span class="st">`"</span>.<span class="bu">format</span>(label)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    x_label <span class="op">=</span> <span class="st">"`</span><span class="sc">{}</span><span class="st">`</span><span class="ch">\n</span><span class="st">Partial Residuals"</span>.<span class="bu">format</span>(label)</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List of all IVs other than the current one.</span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>    others <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> iv_list <span class="cf">if</span> col <span class="op">!=</span> label]</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> sm.graphics.plot_partregress(</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>        endog <span class="op">=</span> <span class="st">"R_sat_score"</span>,</span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>        exog_i <span class="op">=</span> label,</span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>        exog_others <span class="op">=</span> others,</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> data,</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>        obs_labels <span class="op">=</span> show_dbn,</span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>    plt.title(title)</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(x_label)</span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"SAT Score</span><span class="ch">\n</span><span class="st">Partial Residuals"</span>)</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a>    plt.legend(</span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> [<span class="st">"Actual partial residuals"</span>, <span class="st">"Trend line"</span>],</span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>        loc <span class="op">=</span> <span class="st">"best"</span>,</span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout(</span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>        h_pad <span class="op">=</span> <span class="dv">2</span>,</span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-34"><a href="#cb119-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb119-35"><a href="#cb119-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb119-36"><a href="#cb119-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> label <span class="kw">in</span> iv_list:</span>
<span id="cb119-37"><a href="#cb119-37" aria-hidden="true" tabindex="-1"></a>    par_reg_plot(regression_data, label)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-4.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-5.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="2021-06-13-How-Student-Demographic-Affects-SAT-Performance-NYC_files/figure-html/cell-80-output-6.png" class="img-fluid"></p>
</div>
</div>
<p>We can observe that:</p>
<ul>
<li><strong>English Language Learner percentage</strong> and <strong>Special Education percentage</strong> fit the linear trend best.</li>
<li>Female percentage residuals all cluster around one spot and don’t follow a trend.</li>
<li>The other variables, which involve race percentages, seem to be <strong>affected by outliers</strong>.</li>
</ul>
<p>We should keep these plots in mind as we interpret the model results since these don’t show whether outliers may have led to an overestimation of the significance of a predictor.</p>
</section>
<section id="interpretation-of-results" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-of-results">Interpretation of Results</h2>
<p>Below is the first table of model results.</p>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>tables[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">0</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Dep. Variable:</td>
<td>R_sat_score</td>
<td>R-squared:</td>
<td>7.860000e-01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Model:</td>
<td>OLS</td>
<td>Adj. R-squared:</td>
<td>7.820000e-01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Method:</td>
<td>Least Squares</td>
<td>F-statistic:</td>
<td>9.644000e+01</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Date:</td>
<td>Mon, 13 Dec 2021</td>
<td>Prob (F-statistic):</td>
<td>3.410000e-74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Time:</td>
<td>10:27:39</td>
<td>Log-Likelihood:</td>
<td>-2.330700e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>No. Observations:</td>
<td>401</td>
<td>AIC:</td>
<td>4.675000e+03</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Df Residuals:</td>
<td>394</td>
<td>BIC:</td>
<td>4.703000e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Df Model:</td>
<td>6</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Covariance Type:</td>
<td>HC0</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Multiple regression analysis was used to test if a school’s percentages of English Language Learners, Special Education students, female students Asian students, black students, and white students significantly predicted the school’s average total SAT score.</p>
<p>The six predictors explained 78.6% of the variance (R2= 0.786, F(6, 394) = 96.44, p &lt; 0.01).</p>
<p>Next is the second table of results, which shows the beta coefficient, p-value, etc. for each predictor variable.</p>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>tables[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">coef</th>
<th data-quarto-table-cell-role="th">std err</th>
<th data-quarto-table-cell-role="th">z</th>
<th data-quarto-table-cell-role="th">P&gt;|z|</th>
<th data-quarto-table-cell-role="th">[0.025</th>
<th data-quarto-table-cell-role="th">0.975]</th>
<th data-quarto-table-cell-role="th">VIF</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">const</td>
<td>1430.1978</td>
<td>32.665</td>
<td>43.784</td>
<td>0.00</td>
<td>1366.175</td>
<td>1494.220</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_ell_percent</td>
<td>-5.2206</td>
<td>0.320</td>
<td>-16.290</td>
<td>0.00</td>
<td>-5.849</td>
<td>-4.592</td>
<td>1.600755</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_sped_percent</td>
<td>-8.6750</td>
<td>0.861</td>
<td>-10.076</td>
<td>0.00</td>
<td>-10.362</td>
<td>-6.988</td>
<td>3.824473</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_female_per</td>
<td>-0.8097</td>
<td>0.316</td>
<td>-2.564</td>
<td>0.01</td>
<td>-1.429</td>
<td>-0.191</td>
<td>7.289758</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_asian_per</td>
<td>3.5967</td>
<td>0.524</td>
<td>6.861</td>
<td>0.00</td>
<td>2.569</td>
<td>4.624</td>
<td>1.788134</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">D_black_per</td>
<td>-1.3553</td>
<td>0.182</td>
<td>-7.446</td>
<td>0.00</td>
<td>-1.712</td>
<td>-0.999</td>
<td>3.926733</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">D_white_per</td>
<td>3.8196</td>
<td>0.604</td>
<td>6.329</td>
<td>0.00</td>
<td>2.637</td>
<td>5.002</td>
<td>1.777499</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The predicted average SAT score in a school is approximately equal to 1430 - 5.22(ELL percentage) - 8.68(SpEd percentage) - 0.81(female percentage) + 3.60(Asian percentage) - 1.36(black percentage) + 3.82(white percentage).</p>
<p>All of the independent variables used in the model were <strong>significant predictors</strong> of the school’s average SAT score, with p &lt; 0.05. However, since the female percentage variable’s VIF value was greater than 5, strong multicollinearity was present, so its significance value may not be reliably interpreted.</p>
<p>The coefficients for ELL percentage, SpEd percentage, and black student percentage were <strong>negative</strong>. This means that these factors are associated with lower average SAT score in an NYC high school.</p>
<p>On the other hand, the coefficients for Asian percentage and white percentage were <strong>positive</strong>. This means that these factors are associated with higher average SAT score in an NYC high school. However, the linear relationship in the partial regression plots appeared to be affected by outliers, so the effect of these variables may not be strong for the majority of high schools.</p>
<p>In general, however, these results present initial evidence that <strong>race percentages</strong> in an NYC high school may significantly affect its average SAT score.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>In this project, we cleaned, transformed, and combined multiple datasets about New York City high schools. We then conducted exploratory data analysis using Pearson’s correlation coefficients and bivariate scatterplots.</p>
<p>Then, multiple linear regression was performed. The model explained 78.6% of the variance (R2= 0.786, F(6, 394) = 96.44, p &lt; 0.01). This supports the claim that the percentage of each race in a school has an effect on the school’s average SAT score.</p>
<p>Thanks for reading!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="MiguelAHG/migs-germar-data-science-blog" data-repo-id="R_kgDOJySw9w" data-category="Announcements" data-category-id="DIC_kwDOJySw984CXXr6" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
</div> <!-- /content -->



</body></html>